<!doctype html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PeakOS - Advanced Browser Environment</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><path d='M50 10 L70 50 L90 90 L 10 90 L30 50 Z' fill='%2300d4ff'/><path d='M50 10 L60 30 L50 35 L40 30 Z' fill='%23fff'/></svg>" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto:wght@400;500;700&family=Fira+Code&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; cursor: none !important; }
        
        :root {
            --bg: #0a0e27; --bg2: #151b3d; --bg3: #1e2749;
            --acc: #00d4ff; --txt: #e8eaf0; --txt2: #8b93b8;
            --border: rgba(255,255,255,0.08); --border-acc: rgba(0,212,255,0.4);
            --glow: rgba(0,212,255,0.2);
            --shadow-lg: 0 20px 60px rgba(0,0,0,0.7);
            --shadow-md: 0 8px 32px rgba(0,0,0,0.4);
        }
        
        /* ‚ïê‚ïê‚ïê THEME PRESETS ‚ïê‚ïê‚ïê */
        body.theme-midnight { --bg: #0a0e27; --bg2: #151b3d; --bg3: #1e2749; --acc: #00d4ff; --glow: rgba(0,212,255,0.2); }
        body.theme-neon { --bg: #000814; --bg2: #001233; --bg3: #001845; --acc: #ff00ff; --glow: rgba(255,0,255,0.2); }
        body.theme-aurora { --bg: #0a1a2d; --bg2: #152a4d; --bg3: #1f3a6d; --acc: #00ffaa; --glow: rgba(0,255,170,0.2); }
        body.theme-sunset { --bg: #1a0e1a; --bg2: #2d1830; --bg3: #3d2340; --acc: #ff6b35; --glow: rgba(255,107,53,0.2); }
        body.theme-cyber { --bg: #0d0d1a; --bg2: #1a1a33; --bg3: #27274d; --acc: #00ffff; --glow: rgba(0,255,255,0.2); }
        body.theme-matrix { --bg: #000f00; --bg2: #001a00; --bg3: #002500; --acc: #00ff00; --glow: rgba(0,255,0,0.2); }
        body.theme-space { --bg: #000016; --bg2: #01012e; --bg3: #020246; --acc: #9370ff; --glow: rgba(147,112,255,0.2); }
        body.theme-ocean { --bg: #001f3f; --bg2: #003366; --bg3: #004080; --acc: #00a8ff; --glow: rgba(0,168,255,0.2); }
        body.theme-fire { --bg: #1a0a00; --bg2: #331400; --bg3: #4d1f00; --acc: #ff4400; --glow: rgba(255,68,0,0.2); }
        body.theme-forest { --bg: #0a1a0a; --bg2: #143314; --bg3: #1f4d1f; --acc: #33cc33; --glow: rgba(51,204,51,0.2); }
        
        body.high-contrast { --bg: #000; --bg2: #111; --bg3: #222; --txt: #fff; --txt2: #aaa; --border: rgba(255,255,255,0.3); }
        body.reduced-motion * { animation: none !important; transition: none !important; }
        body.performance-mode #desktop-bg { display: none; }
        body.font-large { font-size: 18px; }
        body.no-cursor { cursor: default; }
        body.no-cursor #cursor { display: none !important; }
        
        html, body { width: 100%; height: 100%; font-family: 'Inter', 'Roboto', sans-serif; overflow: hidden; }
        body { background: var(--bg); color: var(--txt); transition: background-color 0.3s; cursor: none; }
        body.unlocked { cursor: none; }
        
        /* ‚ïê‚ïê‚ïê LOADING SCREEN ‚ïê‚ïê‚ïê */
        #loading-screen {
            position: fixed; inset: 0; background: var(--bg); z-index: 999999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: opacity 0.8s ease-out, visibility 0.8s ease-out;
        }
        #loading-screen.hidden { opacity: 0; visibility: hidden; pointer-events: none; }
        .loading-logo { width: 200px; height: 200px; position: relative; margin-bottom: 40px; }
        .loading-logo svg { width: 100%; height: 100%; animation: pulse 2s infinite ease-in-out; filter: drop-shadow(0 0 30px rgba(0,212,255,0.5)); }
        @keyframes pulse { 0%, 100% { transform: scale(1) rotate(0deg); opacity: 1; } 50% { transform: scale(1.05) rotate(5deg); opacity: 0.8; } }
        .loading-text { font-family: 'Orbitron', sans-serif; font-size: 32px; font-weight: 900; color: var(--acc); text-shadow: 0 0 30px var(--glow); letter-spacing: 5px; margin-bottom: 20px; position: relative; }
        .loading-text::after { content: ''; position: absolute; bottom: -10px; left: 0; width: 100%; height: 2px; background: linear-gradient(90deg, transparent, var(--acc), transparent); animation: scan 2s infinite linear; }
        @keyframes scan { 0% { transform: translateX(-100%); } 100% { transform: translateX(100%); } }
        .loading-bar { width: 400px; height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; overflow: hidden; margin-top: 30px; }
        .loading-progress { height: 100%; background: linear-gradient(90deg, var(--acc), #00a8ff); width: 0%; transition: width 0.5s ease; border-radius: 3px; position: relative; overflow: hidden; }
        .loading-progress::after { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent); animation: shimmer 1.5s infinite; }
        @keyframes shimmer { 0% { transform: translateX(-100%); } 100% { transform: translateX(100%); } }
        .loading-stats { margin-top: 20px; font-family: 'Fira Code', monospace; font-size: 14px; color: var(--txt2); text-align: center; }
        
        /* ‚ïê‚ïê‚ïê POINTER CURSOR ‚ïê‚ïê‚ïê */
        #cursor { 
            position: fixed; left: 0; top: 0; pointer-events: none; z-index: 999999;
            display: none; transform: translate(-50%, -50%);
        }
        body.unlocked #cursor { display: block; }
        
        .cursor-pointer {
            width: 0; height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-bottom: 18px solid var(--acc);
            transform: rotate(-45deg);
            filter: drop-shadow(0 0 6px var(--acc)) drop-shadow(0 0 12px var(--glow));
            transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }
        
        .cursor-pointer::after {
            content: '';
            position: absolute; top: 18px; left: -5px;
            width: 10px; height: 3px;
            background: var(--acc);
            box-shadow: 0 0 8px var(--acc);
        }
        
        #cursor.click .cursor-pointer {
            transform: rotate(-45deg) scale(0.85);
            filter: drop-shadow(0 0 10px var(--acc)) drop-shadow(0 0 20px var(--glow));
        }
        
        #cursor.hover .cursor-pointer {
            border-bottom-color: #fff;
            filter: drop-shadow(0 0 8px #fff) drop-shadow(0 0 16px rgba(255,255,255,0.5));
            transform: rotate(-45deg) scale(1.2);
        }
        
        #cursor.hover .cursor-pointer::after { background: #fff; box-shadow: 0 0 10px #fff; }
        body.resizing #cursor .cursor-pointer { border-bottom-color: #ff6b35; filter: drop-shadow(0 0 8px #ff6b35); }
        body.dragging #cursor .cursor-pointer { border-bottom-color: #00ffaa; filter: drop-shadow(0 0 8px #00ffaa); }
        
        /* ‚ïê‚ïê‚ïê BACKGROUND WITH SMALLER CENTERED PEAK LOGO ‚ïê‚ïê‚ïê */
        #desktop-bg { 
            position: fixed; inset: 0; z-index: 0; 
            transition: background .5s ease; 
            display: flex; align-items: center; justify-content: center;
            overflow: hidden;
        }
        
        .peak-logo-bg {
            position: absolute;
            width: 100%; height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0.04;
            z-index: 1;
            pointer-events: none;
        }
        
        .peak-logo-text {
            font-family: 'Orbitron', sans-serif;
            font-size: 15vw;
            font-weight: 900;
            color: var(--acc);
            text-shadow: 0 0 80px var(--glow);
            letter-spacing: 2vw;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .peak-logo-text span { position: relative; }
        .peak-logo-text span:nth-child(1) { animation: float 20s infinite ease-in-out; }
        .peak-logo-text span:nth-child(2) { animation: float 20s infinite ease-in-out 2s; }
        .peak-logo-text span:nth-child(4) { animation: float 20s infinite ease-in-out 4s; }
        
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); opacity: 0.04; }
            50% { transform: translateY(-15px) rotate(1deg); opacity: 0.06; }
        }
        
        .mountain-a {
            position: relative;
            width: 1.8em; height: 1.8em;
            display: inline-block;
            margin: 0 0.2em;
            vertical-align: middle;
        }
        
        .mountain-a svg {
            width: 100%; height: 100%;
            filter: drop-shadow(0 0 25px rgba(0,212,255,0.3));
        }
        
        #desktop-bg.bg-gradient-1 { background: linear-gradient(135deg, #0a0e27 0%, #1e2749 100%); }
        #desktop-bg.bg-gradient-2 { background: linear-gradient(135deg, #1a0e0a 0%, #3d2318 100%); }
        #desktop-bg.bg-gradient-3 { background: linear-gradient(135deg, #0a1a0e 0%, #1e3d27 100%); }
        #desktop-bg.bg-gradient-4 { background: linear-gradient(135deg, #140a1a 0%, #351e3d 100%); }
        #desktop-bg.bg-gradient-5 { background: linear-gradient(135deg, #001f3f 0%, #004080 100%); }
        #desktop-bg.bg-gradient-6 { background: linear-gradient(135deg, #1a0a00 0%, #4d1f00 100%); }
        #desktop-bg.bg-gradient-7 { background: linear-gradient(135deg, #0a1a0a 0%, #1f4d1f 100%); }
        #desktop-bg.bg-gradient-8 { background: linear-gradient(135deg, #1a001a 0%, #4d004d 100%); }
        #desktop-bg.bg-stars { background: #000; background-image: radial-gradient(white, rgba(255,255,255,.2) 2px, transparent 3px), radial-gradient(white, rgba(255,255,255,.15) 1px, transparent 2px), radial-gradient(white, rgba(255,255,255,.1) 2px, transparent 3px); background-size: 550px 550px, 350px 350px, 250px 250px; background-position: 0 0, 40px 60px, 130px 270px; }
        #desktop-bg.bg-grid { background: linear-gradient(90deg, var(--border) 1px, transparent 1px), linear-gradient(var(--border) 1px, transparent 1px); background-size: 40px 40px; }
        #desktop-bg.bg-waves { background: radial-gradient(circle at 20% 80%, rgba(0,212,255,0.15) 0%, transparent 50%), radial-gradient(circle at 80% 20%, rgba(168,85,247,0.15) 0%, transparent 50%), var(--bg); }
        #desktop-bg.bg-nebula { background: radial-gradient(ellipse at 30% 50%, rgba(147,51,234,0.2) 0%, transparent 50%), radial-gradient(ellipse at 70% 50%, rgba(59,130,246,0.2) 0%, transparent 50%), var(--bg); }
        #desktop-bg.bg-aurora { background: linear-gradient(180deg, transparent 40%, rgba(0,255,170,0.1) 60%, transparent 80%), linear-gradient(180deg, rgba(0,212,255,0.1) 20%, transparent 40%), var(--bg); }
        #desktop-bg.bg-custom { background-size: cover; background-position: center; background-repeat: no-repeat; }
        
        /* ‚ïê‚ïê‚ïê DISGUISE ‚ïê‚ïê‚ïê */
        #disguise { position: fixed; inset: 0; z-index: 99999; background: #f0f2f5; overflow-y: auto; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; transition: opacity .5s, transform .5s; cursor: default !important; }
        #disguise.hide { opacity: 0; transform: scale(1.02); pointer-events: none; }
        body.logged-in #disguise { display: none; }
        #disguise * { cursor: default !important; }
        .edu-wrap { max-width: 1200px; margin: 0 auto; padding: 40px 20px; min-height: 100vh; }
        .edu-header { background: linear-gradient(135deg, #1a237e, #283593); border-radius: 20px; box-shadow: 0 8px 32px rgba(0,0,0,0.1); padding: 40px; display: flex; align-items: center; gap: 30px; margin-bottom: 40px; border: 1px solid rgba(255,255,255,0.1); color: white; }
        .edu-logo { width: 80px; height: 80px; border-radius: 20px; background: linear-gradient(135deg, #ffffff, #e3f2fd); color: #1a237e; display: flex; align-items: center; justify-content: center; font-size: 36px; font-weight: 800; box-shadow: 0 8px 24px rgba(0,0,0,0.2); border: 3px solid white; }
        .edu-brand h1 { font-size: 36px; color: #ffffff; font-weight: 700; letter-spacing: -0.5px; margin-bottom: 8px; }
        .edu-brand p { color: rgba(255,255,255,0.9); font-size: 16px; font-weight: 400; }
        .edu-hero { background: white; border-radius: 20px; padding: 50px; margin-bottom: 40px; box-shadow: 0 8px 32px rgba(0,0,0,0.08); border: 1px solid #e0e0e0; }
        .edu-hero-content { display: grid; grid-template-columns: 2fr 1fr; gap: 50px; align-items: center; }
        .edu-hero-text h2 { color: #1a237e; font-size: 32px; margin-bottom: 20px; font-weight: 700; }
        .edu-hero-text p { color: #546e7a; font-size: 18px; line-height: 1.6; margin-bottom: 30px; }
        #unlock-trigger { background: linear-gradient(135deg, #1a237e, #283593); border: none; border-radius: 18px; padding: 20px 36px; cursor: pointer !important; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); color: white; font-weight: 600; font-size: 16px; box-shadow: 0 8px 30px rgba(26, 35, 126, 0.4); display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 120px; position: relative; overflow: hidden; }
        #unlock-trigger:hover { transform: translateY(-8px) scale(1.05); box-shadow: 0 16px 40px rgba(26, 35, 126, 0.5); }
        #unlock-trigger:active { transform: translateY(-4px) scale(1.02); box-shadow: 0 10px 35px rgba(26, 35, 126, 0.45); }
        #unlock-trigger .unlock-status { font-size: 13px; opacity: 0.9; margin-top: 8px; font-weight: 400; }
        
        /* ‚ïê‚ïê‚ïê LOGIN SCREEN ‚ïê‚ïê‚ïê */
        #login-screen {
            position: fixed; inset: 0; z-index: 99998;
            background: linear-gradient(135deg, var(--bg) 0%, var(--bg3) 100%);
            display: none;
            align-items: center; justify-content: center;
            transition: opacity 0.5s;
        }
        #login-screen.show { display: flex; }
        #login-screen.hide { opacity: 0; pointer-events: none; }
        body.logged-in #login-screen { display: none; }
        
        .login-container {
            background: var(--bg2);
            border: 2px solid var(--border-acc);
            border-radius: 24px;
            padding: 60px;
            box-shadow: var(--shadow-lg);
            max-width: 500px;
            width: 90%;
            text-align: center;
        }
        
        .login-logo {
            width: 120px; height: 120px;
            margin: 0 auto 30px;
        }
        
        .login-logo svg {
            width: 100%; height: 100%;
            filter: drop-shadow(0 0 30px var(--glow));
        }
        
        .login-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 36px;
            font-weight: 900;
            background: linear-gradient(135deg, var(--acc), #6fe7ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        
        .login-subtitle {
            font-size: 14px;
            color: var(--txt2);
            margin-bottom: 40px;
        }
        
        .login-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .input-group {
            position: relative;
        }
        
        .input-group input {
            width: 100%;
            background: var(--bg3);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 16px 20px;
            font-size: 15px;
            color: var(--txt);
            transition: all 0.3s;
            font-family: 'Inter', sans-serif;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: var(--acc);
            box-shadow: 0 0 0 4px var(--glow);
        }
        
        .input-group input::placeholder {
            color: var(--txt2);
        }
        
        .login-btn {
            background: linear-gradient(135deg, var(--acc), rgba(0,212,255,0.8));
            border: none;
            border-radius: 12px;
            padding: 18px;
            font-size: 16px;
            font-weight: 700;
            color: var(--bg);
            cursor: pointer !important;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 8px 30px var(--glow);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .login-btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px var(--glow);
        }
        
        .login-btn:active {
            transform: translateY(-2px);
        }
        
        .login-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed !important;
        }
        
        .login-error {
            background: rgba(239,68,68,0.1);
            border: 1px solid rgba(239,68,68,0.3);
            border-radius: 8px;
            padding: 12px;
            color: #ef4444;
            font-size: 13px;
            display: none;
        }
        
        .login-error.show { display: block; }
        
        .login-toggle {
            margin-top: 20px;
            font-size: 13px;
            color: var(--txt2);
        }
        
        .login-toggle a {
            color: var(--acc);
            cursor: pointer !important;
            text-decoration: none;
            font-weight: 600;
        }
        
        .login-toggle a:hover {
            text-decoration: underline;
        }
        
        /* ‚ïê‚ïê‚ïê OS DESKTOP ‚ïê‚ïê‚ïê */
        #os { position: fixed; inset: 0; display: flex; flex-direction: column; opacity: 0; transition: opacity .6s; pointer-events: none; }
        body.logged-in #os { opacity: 1; pointer-events: auto; }
        #desktop { position: relative; z-index: 2; flex: 1; padding: 30px; overflow: hidden; }
        
        /* ‚ïê‚ïê‚ïê DESKTOP ICONS ‚ïê‚ïê‚ïê */
        .desktop-icons { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, 90px); 
            gap: 20px; 
            grid-auto-rows: 90px;
        }
        .desktop-icon { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            gap: 6px; 
            padding: 12px; 
            border-radius: 14px; 
            cursor: pointer; 
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1); 
            background: rgba(255,255,255,0.03); 
            border: 2px solid transparent; 
            position: relative; 
            overflow: hidden;
            height: 90px;
            width: 90px;
        }
        .desktop-icon:hover { 
            background: rgba(255,255,255,0.1); 
            border-color: var(--border-acc); 
            transform: translateY(-4px) scale(1.05); 
            box-shadow: 0 12px 40px rgba(0,0,0,0.4); 
        }
        .desktop-icon:active { 
            transform: translateY(-2px) scale(1.02); 
            background: rgba(255,255,255,0.07); 
            box-shadow: 0 8px 30px rgba(0,0,0,0.3); 
        }
        .desktop-icon-img { 
            width: 42px; 
            height: 42px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
        }
        .desktop-icon-img svg { 
            width: 100%; 
            height: 100%; 
            filter: drop-shadow(0 0 10px rgba(0,212,255,0.3)); 
        }
        .desktop-icon-label { 
            font-size: 11px; 
            color: var(--txt); 
            text-align: center; 
            font-weight: 600; 
            text-shadow: 0 1px 3px rgba(0,0,0,0.8); 
            padding: 4px 6px; 
            border-radius: 6px; 
            background: rgba(0,0,0,0.4); 
            backdrop-filter: blur(10px); 
            max-width: 100%; 
            overflow: hidden; 
            text-overflow: ellipsis; 
            white-space: nowrap;
            line-height: 1.2;
        }
        
        /* ‚ïê‚ïê‚ïê WINDOWS ‚ïê‚ïê‚ïê */
        .window { 
            position: absolute; 
            background: var(--bg2); 
            border: 1px solid var(--border-acc); 
            border-radius: 14px; 
            box-shadow: var(--shadow-lg); 
            display: flex; 
            flex-direction: column; 
            opacity: 0; 
            pointer-events: none; 
            min-width: 500px; 
            min-height: 400px; 
            overflow: hidden; 
            resize: none; 
            transition: opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1), 
                        transform 0.3s cubic-bezier(0.4, 0, 0.2, 1),
                        box-shadow 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .window.show { 
            opacity: 1; 
            pointer-events: auto; 
            z-index: 100; 
            animation: windowAppear 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        @keyframes windowAppear {
            0% { 
                opacity: 0;
                transform: scale(0.95) translateY(20px);
            }
            100% { 
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }
        .window.maximized { top: 0 !important; left: 0 !important; right: 0 !important; bottom: 56px !important; width: 100% !important; height: calc(100% - 56px) !important; border-radius: 0; }
        .window.minimized { opacity: 0; pointer-events: none; transform: translateY(100px); }
        .window.resizing { transition: none !important; }
        .window-titlebar { display: flex; align-items: center; gap: 10px; padding: 10px 14px; background: var(--bg3); border-bottom: 1px solid var(--border); cursor: move; user-select: none; }
        .window-title { flex: 1; font-size: 13px; font-weight: 600; color: var(--txt); }
        .window-controls { display: flex; gap: 6px; }
        .window-btn { width: 28px; height: 28px; border-radius: 6px; background: transparent; border: 1px solid var(--border); color: var(--txt2); cursor: pointer; font-size: 12px; display: flex; align-items: center; justify-content: center; transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); position: relative; overflow: hidden; }
        .window-btn:hover { background: rgba(255,255,255,0.15); color: var(--txt); transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
        .window-btn:active { transform: translateY(0) scale(0.95); background: rgba(255,255,255,0.1); }
        .window-btn.close:hover { background: #ef4444; color: #fff; border-color: #ef4444; box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3); }
        .window-btn.close:active { background: #dc2626; transform: translateY(0) scale(0.95); }
        .tab-content { display: none; flex: 1; overflow: hidden; position: relative; }
        .tab-content.active { display: flex; flex-direction: column; }
        .content-frame { flex: 1; background: #000; position: relative; }
        .content-frame iframe { width: 100%; height: 100%; border: none; }
        .frame-navbar { display: flex; align-items: center; gap: 10px; padding: 10px 14px; background: var(--bg3); border-bottom: 1px solid var(--border); }
        .nav-btn { width: 32px; height: 32px; border-radius: 8px; background: rgba(255,255,255,0.08); border: 1px solid var(--border); color: var(--txt2); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); position: relative; overflow: hidden; }
        .nav-btn:hover { background: rgba(255,255,255,0.15); color: var(--txt); transform: translateY(-2px) scale(1.05); box-shadow: 0 4px 16px rgba(0,0,0,0.2); }
        .nav-btn:active { transform: translateY(0) scale(0.98); background: rgba(255,255,255,0.12); }
        .frame-loading { position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 16px; background: #000; z-index: 10; transition: opacity .3s; }
        .frame-loading.hide { opacity: 0; pointer-events: none; }
        .loading-spinner { width: 48px; height: 48px; border: 3px solid var(--bg3); border-top-color: var(--acc); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading-text { font-size: 13px; color: var(--txt2); font-family: 'Fira Code',monospace; }
        .frame-error { display: none; flex-direction: column; align-items: center; justify-content: center; gap: 16px; padding: 50px; text-align: center; }
        .frame-error.show { display: flex; }
        .error-icon { font-size: 60px; }
        .error-title { font-size: 18px; font-weight: 700; color: var(--txt); }
        .error-msg { font-size: 13px; color: var(--txt2); max-width: 400px; line-height: 1.6; }
        .error-btn { padding: 12px 30px; background: var(--acc); color: var(--bg); border: none; border-radius: 10px; font-weight: 600; cursor: pointer; transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); position: relative; overflow: hidden; box-shadow: 0 4px 20px var(--glow); }
        .error-btn:hover { transform: translateY(-3px) scale(1.05); box-shadow: 0 8px 30px var(--glow); }
        .error-btn:active { transform: translateY(-1px) scale(0.98); box-shadow: 0 4px 15px var(--glow); }
        
        /* Grid Content */
        .content-grid { flex: 1; overflow-y: auto; padding: 24px; }
        .content-grid::-webkit-scrollbar { width: 8px; }
        .content-grid::-webkit-scrollbar-thumb { background: var(--border-acc); border-radius: 5px; }
        .content-grid::-webkit-scrollbar-track { background: var(--bg3); }
        .grid-header { margin-bottom: 24px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 16px; }
        .grid-title { font-size: 28px; font-weight: 900; color: var(--txt); font-family: 'Orbitron',sans-serif; background: linear-gradient(135deg, var(--acc), #6fe7ff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-shadow: 0 0 30px var(--glow); }
        .grid-subtitle { font-size: 13px; color: var(--txt2); margin-top: 6px; }
        .grid-btn { padding: 10px 20px; background: var(--bg3); border: 1px solid var(--border); border-radius: 10px; color: var(--txt); cursor: pointer; transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); display: inline-flex; align-items: center; gap: 8px; font-weight: 500; position: relative; overflow: hidden; min-height: 40px; white-space: nowrap; }
        .grid-btn:hover { background: rgba(255,255,255,0.1); border-color: var(--border-acc); transform: translateY(-3px); box-shadow: 0 6px 20px rgba(0,0,0,0.3); }
        .grid-btn:active { transform: translateY(-1px) scale(0.98); background: rgba(255,255,255,0.08); }
        .grid-btn.primary { background: linear-gradient(135deg, var(--acc), rgba(0,212,255,0.8)); color: var(--bg); border: none; box-shadow: 0 4px 20px rgba(0,212,255,0.3); }
        .grid-btn.primary:hover { background: linear-gradient(135deg, var(--acc), rgba(0,212,255,0.9)); transform: translateY(-3px) scale(1.02); box-shadow: 0 8px 25px rgba(0,212,255,0.4); }
        .grid-btn.primary:active { transform: translateY(-1px) scale(0.98); box-shadow: 0 4px 15px rgba(0,212,255,0.3); }
        .grid-btn:disabled { opacity: 0.5; cursor: not-allowed !important; }
        
        /* ‚ïê‚ïê‚ïê IMPROVED ITEM GRID WITH BETTER TEXT HANDLING ‚ïê‚ïê‚ïê */
        .item-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 16px; }
        .item-card { background: var(--bg3); border: 1px solid var(--border); border-radius: 16px; padding: 20px; cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); display: flex; flex-direction: column; gap: 14px; position: relative; overflow: hidden; }
        .item-card::before { content: ''; position: absolute; inset: 0; background: linear-gradient(135deg, var(--glow), transparent); opacity: 0; transition: opacity 0.3s; }
        .item-card:hover::before { opacity: 0.4; }
        .item-card:hover { border-color: var(--border-acc); transform: translateY(-6px) scale(1.02); box-shadow: 0 16px 40px rgba(0,0,0,0.4); }
        .item-card:active { transform: translateY(-3px) scale(1.01); box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .item-header { display: flex; align-items: flex-start; gap: 14px; min-height: 60px; }
        .item-icon { font-size: 36px; flex-shrink: 0; }
        .item-content { flex: 1; min-width: 0; display: flex; flex-direction: column; gap: 6px; }
        .item-name { 
            font-size: 15px; 
            font-weight: 700; 
            color: var(--txt); 
            overflow: hidden; 
            text-overflow: ellipsis; 
            display: -webkit-box; 
            -webkit-line-clamp: 2; 
            -webkit-box-orient: vertical; 
            line-height: 1.3; 
            max-height: 2.6em; 
            word-wrap: break-word;
            word-break: break-word;
        }
        .item-desc { 
            font-size: 12px; 
            color: var(--txt2); 
            line-height: 1.4; 
            overflow: hidden; 
            text-overflow: ellipsis; 
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
        }
        .item-actions { display: flex; gap: 8px; flex-wrap: wrap; margin-top: auto; }
        .item-links { display: flex; gap: 6px; flex-wrap: wrap; }
        .link-btn { padding: 8px 14px; background: rgba(255,255,255,0.07); border: 1px solid var(--border); border-radius: 8px; font-size: 12px; color: var(--txt2); cursor: pointer; transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); display: flex; align-items: center; gap: 6px; position: relative; overflow: hidden; min-height: 32px; white-space: nowrap; }
        .link-btn:hover { background: var(--glow); color: var(--txt); transform: translateY(-2px); border-color: var(--border-acc); box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
        .link-btn:active { transform: translateY(0) scale(0.96); background: rgba(255,255,255,0.1); }
        .link-number { font-size: 10px; background: var(--acc); color: var(--bg); width: 18px; height: 18px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        
        /* Styles App */
        .styles-content { flex: 1; overflow-y: auto; padding: 24px; }
        .styles-section { margin-bottom: 32px; }
        .styles-section-title { font-size: 13px; font-weight: 700; text-transform: uppercase; letter-spacing: .1em; color: var(--txt2); margin-bottom: 16px; padding-bottom: 10px; border-bottom: 1px solid var(--border); }
        .theme-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 16px; }
        .theme-card { aspect-ratio: 16/9; border-radius: 16px; cursor: pointer; position: relative; overflow: hidden; border: 2px solid var(--border); transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .theme-card.active { border-color: var(--acc); box-shadow: 0 0 0 4px var(--glow); }
        .theme-card:hover { transform: scale(1.08) translateY(-4px); box-shadow: 0 12px 32px rgba(0,0,0,0.4); }
        .theme-card:active { transform: scale(1.04) translateY(-2px); }
        .theme-card-preview { width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; font-size: 36px; background: var(--preview-bg); }
        .theme-card-name { position: absolute; bottom: 0; left: 0; right: 0; background: rgba(0,0,0,0.9); backdrop-filter: blur(10px); padding: 10px; font-size: 12px; font-weight: 600; text-align: center; }
        .bg-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 16px; }
        .bg-card { aspect-ratio: 16/9; border-radius: 16px; cursor: pointer; position: relative; overflow: hidden; border: 2px solid var(--border); transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .bg-card.active { border-color: var(--acc); box-shadow: 0 0 0 4px var(--glow); }
        .bg-card:hover { transform: scale(1.08) translateY(-4px); box-shadow: 0 12px 32px rgba(0,0,0,0.4); }
        .bg-card:active { transform: scale(1.04) translateY(-2px); }
        .bg-card-preview { width: 100%; height: 100%; background: var(--preview-bg); }
        .bg-card-name { position: absolute; bottom: 0; left: 0; right: 0; background: rgba(0,0,0,0.9); backdrop-filter: blur(10px); padding: 10px; font-size: 12px; font-weight: 600; text-align: center; }
        
        /* Settings Controls */
        .settings-controls { display: flex; flex-direction: column; gap: 12px; margin-top: 16px; }
        .setting-item { display: flex; justify-content: space-between; align-items: center; padding: 14px; background: var(--bg3); border: 1px solid var(--border); border-radius: 10px; transition: all 0.2s; }
        .setting-item:hover { border-color: var(--border-acc); }
        .setting-info h4 { font-size: 13px; font-weight: 600; color: var(--txt); }
        .setting-info p { font-size: 11px; color: var(--txt2); margin-top: 3px; }
        .switch { position: relative; display: inline-block; width: 52px; height: 26px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; inset: 0; background-color: var(--bg); border: 1px solid var(--border); transition: .3s cubic-bezier(0.4, 0, 0.2, 1); border-radius: 26px; }
        .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 3px; bottom: 2px; background-color: var(--txt2); transition: .3s cubic-bezier(0.4, 0, 0.2, 1); border-radius: 50%; box-shadow: 0 2px 8px rgba(0,0,0,0.3); }
        input:checked + .slider { background-color: var(--acc); border-color: var(--acc); box-shadow: 0 0 12px var(--glow); }
        input:checked + .slider:before { transform: translateX(26px); background-color: white; box-shadow: 0 2px 8px rgba(0,0,0,0.3); }
        .setting-item:hover .slider { border-color: var(--border-acc); }
        
        /* ‚ïê‚ïê‚ïê TASKBAR WITH PEAK MOUNTAIN BUTTON ‚ïê‚ïê‚ïê */
        #taskbar { 
            position: fixed; 
            bottom: 0; 
            left: 0; 
            right: 0; 
            height: 56px; 
            z-index: 200; 
            background: rgba(21,27,61,0.95); 
            backdrop-filter: blur(20px); 
            border-top: 1px solid var(--border-acc); 
            display: flex; 
            align-items: center; 
            padding: 0 16px; 
            gap: 12px; 
            box-shadow: 0 -4px 20px rgba(0,0,0,0.4); 
        }
        .taskbar-start { display: flex; align-items: center; gap: 12px; }
        .start-btn { 
            width: 48px; 
            height: 48px; 
            border-radius: 14px; 
            background: linear-gradient(135deg, var(--acc), rgba(0,212,255,0.8)); 
            border: none; 
            cursor: pointer; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
            box-shadow: 0 6px 25px var(--glow); 
            position: relative; 
            overflow: hidden; 
        }
        .start-btn:hover { transform: scale(1.15) rotate(15deg); box-shadow: 0 10px 35px var(--glow); }
        .start-btn:active { transform: scale(1.05) rotate(10deg); box-shadow: 0 6px 20px var(--glow); }
        .start-btn svg { width: 28px; height: 28px; }
        
        /* PEAK text in mountain */
        .start-btn-text {
            position: absolute;
            bottom: 8px;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'Orbitron', sans-serif;
            font-size: 7px;
            font-weight: 900;
            color: white;
            letter-spacing: 1px;
            text-shadow: 0 0 4px rgba(0,0,0,0.5);
        }
        
        .taskbar-windows { display: flex; gap: 6px; flex: 1; overflow-x: auto; padding: 0 12px; }
        .taskbar-window-btn { padding: 10px 14px; background: var(--bg3); border: 1px solid var(--border); border-radius: 10px; cursor: pointer; transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); display: flex; align-items: center; gap: 10px; min-width: 160px; max-width: 200px; position: relative; overflow: hidden; }
        .taskbar-window-btn:hover { background: rgba(255,255,255,0.12); transform: translateY(-2px); box-shadow: 0 4px 16px rgba(0,0,0,0.2); }
        .taskbar-window-btn:active { transform: translateY(0) scale(0.98); background: rgba(255,255,255,0.08); }
        .taskbar-window-btn.active { background: var(--glow); border-color: var(--border-acc); box-shadow: 0 4px 20px rgba(0,212,255,0.2); }
        .taskbar-window-btn.active:hover { transform: translateY(-2px) scale(1.02); box-shadow: 0 6px 25px rgba(0,212,255,0.3); }
        .taskbar-window-icon { font-size: 16px; }
        .taskbar-window-title { flex: 1; font-size: 12px; font-weight: 500; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; color: var(--txt2); }
        .taskbar-window-btn.active .taskbar-window-title { color: var(--txt); }
        .taskbar-close-btn { width: 18px; height: 18px; border-radius: 50%; background: rgba(255,255,255,0.1); border: 1px solid var(--border); color: var(--txt2); font-size: 10px; display: flex; align-items: center; justify-content: center; cursor: pointer; opacity: 0; transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); position: relative; overflow: hidden; }
        .taskbar-window-btn:hover .taskbar-close-btn { opacity: 1; transform: translateY(0) scale(1); }
        .taskbar-close-btn:hover { background: #ef4444; border-color: #ef4444; color: white; transform: scale(1.2); box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3); }
        .taskbar-close-btn:active { transform: scale(0.9); background: #dc2626; }
        .taskbar-end { display: flex; align-items: center; gap: 12px; margin-left: auto; }
        .taskbar-icon { width: 40px; height: 40px; border-radius: 10px; background: transparent; border: 1px solid transparent; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); color: var(--txt2); font-size: 18px; position: relative; overflow: hidden; }
        .taskbar-icon:hover { background: rgba(255,255,255,0.15); color: var(--txt); transform: translateY(-2px) scale(1.1); border-color: var(--border-acc); box-shadow: 0 4px 16px rgba(0,0,0,0.3); }
        .taskbar-icon:active { transform: translateY(0) scale(0.95); background: rgba(255,255,255,0.1); }
        .taskbar-clock { padding: 10px 20px; text-align: center; cursor: pointer; border-radius: 10px; transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); position: relative; overflow: hidden; }
        .taskbar-clock:hover { background: rgba(255,255,255,0.1); transform: translateY(-2px); box-shadow: 0 4px 16px rgba(0,0,0,0.2); }
        .taskbar-clock:active { transform: translateY(0) scale(0.98); background: rgba(255,255,255,0.07); }
        .clock-time { font-size: 14px; font-weight: 700; color: var(--txt); font-family: 'Fira Code',monospace; letter-spacing: 1px; }
        .clock-date { font-size: 11px; color: var(--txt2); margin-top: 3px; }
        
        /* ‚ïê‚ïê‚ïê START MENU WITH INTEGRATED SEARCH ‚ïê‚ïê‚ïê */
        #start-menu { position: fixed; bottom: 68px; left: 16px; width: 680px; height: 700px; background: var(--bg2); border: 1px solid var(--border-acc); border-radius: 18px; box-shadow: var(--shadow-lg); display: flex; flex-direction: column; opacity: 0; pointer-events: none; transition: all 0.3s; transform: translateY(30px); }
        #start-menu.show { opacity: 1; pointer-events: auto; transform: translateY(0); z-index: 199; }
        .start-header { padding: 28px; border-bottom: 1px solid var(--border); display: flex; align-items: center; gap: 18px; position: relative; }
        .start-logo { width: 56px; height: 56px; position: relative; }
        .start-logo svg { width: 100%; height: 100%; filter: drop-shadow(0 0 20px rgba(0,212,255,0.5)); }
        .start-brand { flex: 1; }
        .start-title { font-size: 32px; font-weight: 900; font-family: 'Orbitron',sans-serif; background: linear-gradient(135deg, var(--acc), #6fe7ff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-shadow: 0 0 40px var(--glow); letter-spacing: 2px; }
        .start-subtitle { font-size: 13px; color: var(--txt2); margin-top: 6px; }
        .start-version { position: absolute; top: 28px; right: 28px; font-size: 11px; color: var(--txt2); }
        
        /* Search in start menu */
        .start-search { 
            padding: 16px 28px; 
            border-bottom: 1px solid var(--border);
        }
        .start-search-input { 
            width: 100%; 
            background: var(--bg3); 
            border: 2px solid var(--border); 
            border-radius: 12px; 
            padding: 14px 18px; 
            font-size: 14px; 
            color: var(--txt); 
            transition: all 0.3s; 
            font-family: 'Inter', sans-serif; 
        }
        .start-search-input:focus { 
            outline: none; 
            border-color: var(--acc); 
            box-shadow: 0 0 0 3px var(--glow); 
        }
        .start-search-input::placeholder { color: var(--txt2); }
        
        .start-content { flex: 1; overflow-y: auto; padding: 24px; display: grid; grid-template-columns: 1fr 1fr; gap: 28px; }
        .start-section { margin-bottom: 28px; }
        .start-section-title { font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: .1em; color: var(--txt2); margin-bottom: 14px; padding-bottom: 6px; border-bottom: 1px solid var(--border); }
        .start-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 14px; }
        .start-item { background: var(--bg3); border: 1px solid var(--border); border-radius: 16px; padding: 24px 18px; cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); display: flex; flex-direction: column; align-items: center; gap: 14px; text-align: center; position: relative; overflow: hidden; }
        .start-item:hover { background: var(--glow); border-color: var(--border-acc); transform: translateY(-6px) scale(1.05); box-shadow: 0 12px 32px rgba(0,0,0,0.3); }
        .start-item:active { transform: translateY(-3px) scale(1.02); background: rgba(255,255,255,0.15); box-shadow: 0 8px 24px rgba(0,0,0,0.2); }
        .start-item-icon { font-size: 32px; }
        .start-item-label { font-size: 12px; font-weight: 600; color: var(--txt); }
        
        /* ‚ïê‚ïê‚ïê TOAST NOTIFICATIONS ‚ïê‚ïê‚ïê */
        #toast-container { 
            position: fixed; 
            top: 24px; 
            right: 24px; 
            z-index: 9999; 
            display: flex; 
            flex-direction: column; 
            gap: 12px; 
            max-width: 350px;
            pointer-events: none;
        }
        .toast { 
            background: rgba(21, 27, 61, 0.95); 
            border: 1px solid var(--border-acc); 
            border-radius: 14px; 
            padding: 16px 20px; 
            min-width: 300px; 
            box-shadow: var(--shadow-lg); 
            transform: translateX(400px) scale(0.9); 
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55); 
            display: flex; 
            align-items: center; 
            gap: 14px; 
            margin-bottom: 8px; 
            backdrop-filter: blur(10px);
            pointer-events: auto;
            opacity: 0;
        }
        .toast.show { 
            transform: translateX(0) scale(1); 
            opacity: 1;
        }
        .toast.hiding { 
            transform: translateX(400px) scale(0.9); 
            opacity: 0;
        }
        .toast-icon { 
            font-size: 20px; 
            width: 32px; 
            height: 32px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            background: rgba(255,255,255,0.1); 
            border-radius: 50%; 
            flex-shrink: 0;
        }
        .toast-content { flex: 1; }
        .toast-title { font-size: 14px; font-weight: 700; color: var(--txt); }
        .toast-msg { font-size: 12px; color: var(--txt2); margin-top: 3px; line-height: 1.4; }
        .toast.success { border-color: rgba(34,197,94,0.4); }
        .toast.error { border-color: rgba(239,68,68,0.4); }
        
        /* Responsive */
        @media(max-width: 1024px) {
            #start-menu { width: calc(100% - 32px); height: 75vh; }
            .start-grid { grid-template-columns: repeat(2, 1fr); }
            .item-grid { grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); }
            .desktop-icons { grid-template-columns: repeat(auto-fill, 80px); gap: 15px; }
            .desktop-icon { width: 80px; height: 80px; }
        }
        @media(max-width: 768px) {
            .desktop-icons { grid-template-columns: repeat(auto-fill, 70px); gap: 12px; }
            .desktop-icon { width: 70px; height: 70px; }
            .window { min-width: 100% !important; min-height: 400px !important; }
            .start-content { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body class="theme-midnight">

    <!-- LOADING SCREEN -->
    <div id="loading-screen">
        <div class="loading-logo">
            <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <linearGradient id="loadingGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:var(--acc);stop-opacity:1" />
                        <stop offset="50%" style="stop-color:rgba(0,212,255,0.8);stop-opacity:0.8" />
                        <stop offset="100%" style="stop-color:rgba(0,212,255,0.6);stop-opacity:0.6" />
                    </linearGradient>
                    <filter id="loadingGlow">
                        <feGaussianBlur stdDeviation="6" result="coloredBlur"/>
                        <feMerge>
                            <feMergeNode in="coloredBlur"/>
                            <feMergeNode in="SourceGraphic"/>
                        </feMerge>
                    </filter>
                </defs>
                <path d="M 50 10 L 70 50 L 90 90 L 10 90 L 30 50 Z" fill="url(#loadingGrad)" filter="url(#loadingGlow)"/>
                <path d="M 50 10 L 60 30 L 50 35 L 40 30 Z" fill="#ffffff" filter="url(#loadingGlow)"/>
            </svg>
        </div>
        <div class="loading-text">PEAK OS</div>
        <div class="loading-stats" id="loading-stats">Initializing system...</div>
        <div class="loading-bar">
            <div class="loading-progress" id="loading-progress"></div>
        </div>
    </div>

    <!-- POINTER CURSOR -->
    <div id="cursor">
        <div class="cursor-pointer"></div>
    </div>

    <!-- DISGUISE -->
    <div id="disguise">
        <div class="edu-wrap">
            <div class="edu-header">
                <div class="edu-logo">HS</div>
                <div class="edu-brand">
                    <h1>Hillside Secondary School</h1>
                    <p>Student Academic Portal ‚Ä¢ Hillside District</p>
                </div>
            </div>
            <section class="edu-hero">
                <div class="edu-hero-content">
                    <div class="edu-hero-text">
                        <h2>Welcome Back, Student!</h2>
                        <p>Access your classes, view assignments, and connect with teachers through our integrated learning platform.</p>
                    </div>
                    <div>
                        <button id="unlock-trigger">
                            üîì Initialize Session
                            <div class="unlock-status" id="unlock-status">Click 3 times to unlock</div>
                        </button>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- LOGIN SCREEN -->
    <div id="login-screen">
        <div class="login-container">
            <div class="login-logo">
                <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <linearGradient id="loginGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:var(--acc);stop-opacity:1" />
                            <stop offset="50%" style="stop-color:rgba(0,212,255,0.8);stop-opacity:0.8" />
                            <stop offset="100%" style="stop-color:rgba(0,212,255,0.6);stop-opacity:0.6" />
                        </linearGradient>
                    </defs>
                    <path d="M 50 10 L 70 50 L 90 90 L 10 90 L 30 50 Z" fill="url(#loginGrad)"/>
                    <path d="M 50 10 L 60 30 L 50 35 L 40 30 Z" fill="#ffffff"/>
                </svg>
            </div>
            <div class="login-title">PEAK OS</div>
            <div class="login-subtitle" id="login-subtitle">Enter your credentials</div>
            
            <form class="login-form" id="login-form">
                <div class="login-error" id="login-error"></div>
                
                <div class="input-group" id="username-group">
                    <input type="text" id="username-input" placeholder="Username" autocomplete="off">
                </div>
                
                <div class="input-group">
                    <input type="password" id="password-input" placeholder="Password" autocomplete="off">
                </div>
                
                <button type="submit" class="login-btn" id="login-btn">LOGIN</button>
            </form>
            
            <div class="login-toggle">
                <span id="login-toggle-text"></span>
            </div>
        </div>
    </div>

    <!-- OS ENVIRONMENT -->
    <div id="os">
        <div id="desktop-bg" class="bg-gradient-1">
            <!-- Smaller Centered Peak Logo Background -->
            <div class="peak-logo-bg">
                <div class="peak-logo-text">
                    <span>P</span>
                    <span>E</span>
                    <span class="mountain-a">
                        <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                            <path d="M 50 10 L 70 50 L 90 90 L 10 90 L 30 50 Z" fill="currentColor"/>
                            <path d="M 50 10 L 60 30 L 50 35 L 40 30 Z" fill="#ffffff"/>
                        </svg>
                    </span>
                    <span>K</span>
                </div>
            </div>
        </div>
        
        <div id="desktop">
            <div class="desktop-icons">
                <div class="desktop-icon" data-app="dashboard">
                    <div class="desktop-icon-img">
                        <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                            <rect x="15" y="15" width="20" height="20" rx="4" fill="currentColor"/>
                            <rect x="45" y="15" width="20" height="20" rx="4" fill="currentColor"/>
                            <rect x="75" y="15" width="20" height="20" rx="4" fill="currentColor"/>
                            <rect x="15" y="45" width="20" height="40" rx="4" fill="currentColor"/>
                            <rect x="45" y="45" width="20" height="40" rx="4" fill="currentColor"/>
                            <rect x="75" y="45" width="20" height="40" rx="4" fill="currentColor"/>
                        </svg>
                    </div>
                    <div class="desktop-icon-label">Dashboard</div>
                </div>
                <div class="desktop-icon" data-app="proxy-installer">
                    <div class="desktop-icon-img">
                        <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="50" cy="50" r="40" fill="none" stroke="currentColor" stroke-width="4"/>
                            <circle cx="50" cy="50" r="10" fill="currentColor"/>
                            <line x1="50" y1="50" x2="50" y2="15" stroke="currentColor" stroke-width="4"/>
                            <line x1="50" y1="50" x2="85" y2="50" stroke="currentColor" stroke-width="4"/>
                        </svg>
                    </div>
                    <div class="desktop-icon-label">Proxies</div>
                </div>
                <div class="desktop-icon" data-app="game-installer">
                    <div class="desktop-icon-img">
                        <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                            <rect x="15" y="30" width="70" height="40" rx="10" fill="none" stroke="currentColor" stroke-width="4"/>
                            <circle cx="35" cy="50" r="8" fill="currentColor"/>
                            <circle cx="65" cy="45" r="6" fill="currentColor"/>
                        </svg>
                    </div>
                    <div class="desktop-icon-label">Games</div>
                </div>
                <div class="desktop-icon" data-app="files">
                    <div class="desktop-icon-img">üìÅ</div>
                    <div class="desktop-icon-label">Files</div>
                </div>
                <div class="desktop-icon" data-app="calculator">
                    <div class="desktop-icon-img">üî¢</div>
                    <div class="desktop-icon-label">Calculator</div>
                </div>
                <div class="desktop-icon" data-app="notes">
                    <div class="desktop-icon-img">üìù</div>
                    <div class="desktop-icon-label">Notes</div>
                </div>
                <div class="desktop-icon" data-app="styles">
                    <div class="desktop-icon-img">
                        <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="50" cy="35" r="18" fill="none" stroke="currentColor" stroke-width="4"/>
                            <path d="M 35 45 Q 25 60 30 75 L 70 75 Q 75 60 65 45" fill="currentColor"/>
                        </svg>
                    </div>
                    <div class="desktop-icon-label">Styles</div>
                </div>
                <div class="desktop-icon" data-app="settings">
                    <div class="desktop-icon-img">
                        <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="50" cy="50" r="40" fill="none" stroke="currentColor" stroke-width="4"/>
                            <circle cx="50" cy="30" r="6" fill="currentColor"/>
                            <circle cx="65" cy="40" r="6" fill="currentColor"/>
                        </svg>
                    </div>
                    <div class="desktop-icon-label">Settings</div>
                </div>
            </div>
        </div>
        
        <div id="windows-container"></div>
        
        <!-- START MENU WITH SEARCH -->
        <div id="start-menu">
            <div class="start-header">
                <div class="start-logo">
                    <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <linearGradient id="logoGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:var(--acc);stop-opacity:1" />
                                <stop offset="50%" style="stop-color:rgba(0,212,255,0.8);stop-opacity:0.8" />
                                <stop offset="100%" style="stop-color:rgba(0,212,255,0.6);stop-opacity:0.6" />
                            </linearGradient>
                        </defs>
                        <path d="M 50 10 L 70 50 L 90 90 L 10 90 L 30 50 Z" fill="url(#logoGrad)"/>
                        <path d="M 50 10 L 60 30 L 50 35 L 40 30 Z" fill="#ffffff"/>
                    </svg>
                </div>
                <div class="start-brand">
                    <div class="start-title">PEAK OS</div>
                    <div class="start-subtitle">Advanced Browser Environment</div>
                </div>
                <div class="start-version">v3.0</div>
            </div>
            
            <!-- Search Bar in Start Menu -->
            <div class="start-search">
                <input type="text" class="start-search-input" id="start-search-input" placeholder="üîç Search apps, proxies, games...">
            </div>
            
            <div class="start-content" id="start-content">
                <div class="start-section">
                    <div class="start-section-title">üöÄ Applications</div>
                    <div class="start-grid">
                        <div class="start-item" data-app="dashboard">
                            <div class="start-item-icon">üìä</div>
                            <div class="start-item-label">Dashboard</div>
                        </div>
                        <div class="start-item" data-app="proxy-installer">
                            <div class="start-item-icon">üåê</div>
                            <div class="start-item-label">Proxies</div>
                        </div>
                        <div class="start-item" data-app="game-installer">
                            <div class="start-item-icon">üéÆ</div>
                            <div class="start-item-label">Games</div>
                        </div>
                        <div class="start-item" data-app="files">
                            <div class="start-item-icon">üìÅ</div>
                            <div class="start-item-label">Files</div>
                        </div>
                        <div class="start-item" data-app="calculator">
                            <div class="start-item-icon">üî¢</div>
                            <div class="start-item-label">Calculator</div>
                        </div>
                        <div class="start-item" data-app="notes">
                            <div class="start-item-icon">üìù</div>
                            <div class="start-item-label">Notes</div>
                        </div>
                        <div class="start-item" data-app="styles">
                            <div class="start-item-icon">üé®</div>
                            <div class="start-item-label">Styles</div>
                        </div>
                        <div class="start-item" data-app="settings">
                            <div class="start-item-icon">‚öôÔ∏è</div>
                            <div class="start-item-label">Settings</div>
                        </div>
                        <div class="start-item" data-action="close-all">
                            <div class="start-item-icon">‚úï</div>
                            <div class="start-item-label">Close All</div>
                        </div>
                        <div class="start-item" data-action="lock">
                            <div class="start-item-icon">üîí</div>
                            <div class="start-item-label">Lock</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- TASKBAR -->
        <div id="taskbar">
            <div class="taskbar-start">
                <button class="start-btn" id="start-btn">
                    <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                        <path d="M 50 10 L 70 50 L 90 90 L 10 90 L 30 50 Z" fill="currentColor"/>
                        <path d="M 50 10 L 60 30 L 50 35 L 40 30 Z" fill="#ffffff"/>
                    </svg>
                    <div class="start-btn-text">PEAK</div>
                </button>
            </div>
            <div class="taskbar-windows" id="taskbar-windows"></div>
            <div class="taskbar-end">
                <div class="taskbar-icon" id="close-all-btn" title="Close All">‚úï</div>
                <div class="taskbar-icon" id="lock-btn" title="Lock">üîí</div>
                <div class="taskbar-clock" id="taskbar-clock">
                    <div class="clock-time">--:--</div>
                    <div class="clock-date">---</div>
                </div>
            </div>
        </div>
    </div>

    <script>
const $ = s => document.querySelector(s);
const $$ = s => [...document.querySelectorAll(s)];

const loadData = (key, def={}) => {
    try { return JSON.parse(localStorage.getItem('peakos-'+key) || JSON.stringify(def)); }
    catch { return def; }
};

const saveData = (key, data) => localStorage.setItem('peakos-'+key, JSON.stringify(data));

let settings = loadData('settings', {
    theme: 'midnight', background: 'gradient-1', customBg: null,
    contrast: false, motion: false, font: false, performance: false,
    cursor: true, animations: true, notifications: true, blur: true
});

// Auth system
let currentUser = null;

function checkAuth() {
    const savedUser = loadData('currentUser');
    if (savedUser && savedUser.username) {
        currentUser = savedUser;
        return true;
    }
    return false;
}

function initAuth() {
    const users = loadData('users', []);
    const loginScreen = $('#login-screen');
    const loginForm = $('#login-form');
    const usernameInput = $('#username-input');
    const passwordInput = $('#password-input');
    const loginBtn = $('#login-btn');
    const loginError = $('#login-error');
    const loginSubtitle = $('#login-subtitle');
    
    let isSignup = users.length === 0;
    
    function updateUI() {
        if (isSignup) {
            loginBtn.textContent = 'CREATE ACCOUNT';
            loginSubtitle.textContent = 'Create your account to continue';
        } else {
            loginBtn.textContent = 'LOGIN';
            loginSubtitle.textContent = 'Welcome back to PeakOS';
        }
    }
    
    updateUI();
    
    loginForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const username = usernameInput.value.trim();
        const password = passwordInput.value;
        
        if (!username || !password) {
            showError('Please fill in all fields');
            return;
        }
        
        if (isSignup) {
            // Create account
            if (username.length < 3) {
                showError('Username must be at least 3 characters');
                return;
            }
            if (password.length < 4) {
                showError('Password must be at least 4 characters');
                return;
            }
            
            const newUser = { username, password };
            users.push(newUser);
            saveData('users', users);
            currentUser = { username };
            saveData('currentUser', currentUser);
            
            loginSuccess();
        } else {
            // Login
            const user = users.find(u => u.username === username && u.password === password);
            if (user) {
                currentUser = { username };
                saveData('currentUser', currentUser);
                loginSuccess();
            } else {
                showError('Invalid username or password');
            }
        }
    });
    
    function showError(msg) {
        loginError.textContent = msg;
        loginError.classList.add('show');
        setTimeout(() => loginError.classList.remove('show'), 3000);
    }
    
    function loginSuccess() {
        loginScreen.classList.add('hide');
        setTimeout(() => {
            document.body.classList.add('logged-in');
            loginScreen.style.display = 'none';
            bindHover();
            updateClock();
            cursor.style.display = 'block';
            setTimeout(() => {
                openApp('dashboard');
                toast('Welcome!', `Welcome to PeakOS, ${currentUser.username}!`);
            }, 500);
        }, 500);
    }
}

function applySettings() {
    const body = document.body;
    body.className = body.className.replace(/theme-\w+/g, '');
    body.classList.add(`theme-${settings.theme}`);
    body.classList.remove('high-contrast', 'reduced-motion', 'font-large', 'performance-mode', 'no-cursor');
    if (settings.contrast) body.classList.add('high-contrast');
    if (settings.motion) body.classList.add('reduced-motion');
    if (settings.font) body.classList.add('font-large');
    if (settings.performance) body.classList.add('performance-mode');
    if (!settings.cursor) body.classList.add('no-cursor');
    applyBackground(settings.background, settings.customBg);
}
applySettings();

function initLoadingScreen() {
    const loadingScreen = $('#loading-screen');
    const loadingProgress = $('#loading-progress');
    const loadingStats = $('#loading-stats');
    if (!loadingScreen) return;
    const steps = [
        {text: "Initializing core modules...", progress: 10},
        {text: "Loading graphics subsystem...", progress: 25},
        {text: "Starting window manager...", progress: 40},
        {text: "Loading desktop environment...", progress: 60},
        {text: "Initializing network services...", progress: 75},
        {text: "Starting security protocols...", progress: 90},
        {text: "System ready!", progress: 100}
    ];
    let currentStep = 0;
    function updateLoading() {
        if (currentStep >= steps.length) {
            setTimeout(() => {
                loadingScreen.classList.add('hidden');
                setTimeout(() => loadingScreen.style.display = 'none', 800);
            }, 500);
            return;
        }
        const step = steps[currentStep];
        loadingProgress.style.width = step.progress + '%';
        loadingStats.textContent = step.text;
        currentStep++;
        setTimeout(updateLoading, 300 + Math.random() * 500);
    }
    setTimeout(updateLoading, 800);
}

function applyBackground(bg, customUrl) {
    const el = $('#desktop-bg');
    el.className = '';
    el.classList.add('bg-' + bg);
    if (bg === 'custom' && customUrl) {
        el.style.backgroundImage = `url(${customUrl})`;
    } else {
        el.style.backgroundImage = '';
    }
}

const toast = (title, msg, type='success') => {
    if (!settings.notifications) return;
    let container = $('#toast-container');
    if (!container) {
        container = document.createElement('div');
        container.id = 'toast-container';
        document.body.appendChild(container);
    }
    const t = document.createElement('div');
    t.className = `toast ${type}`;
    t.innerHTML = `
        <div class="toast-icon">${type==='success'?'‚úì':'‚úï'}</div>
        <div class="toast-content">
            <div class="toast-title">${title}</div>
            <div class="toast-msg">${msg}</div>
        </div>
    `;
    container.appendChild(t);
    
    const existingToasts = $$('#toast-container .toast.show');
    const offset = existingToasts.length * 90;
    
    setTimeout(() => {
        t.classList.add('show');
        t.style.transform = `translateY(${offset}px) scale(1)`;
        t.style.opacity = '1';
    }, 10);
    
    setTimeout(() => {
        t.classList.remove('show');
        t.classList.add('hiding');
        setTimeout(() => {
            t.remove();
            $$('#toast-container .toast').forEach((toast, idx) => {
                toast.style.transform = `translateY(${idx * 90}px) scale(1)`;
            });
        }, 500);
    }, 3000);
};

const cursor = $('#cursor');
let cursorX = 0, cursorY = 0;
cursor.style.left = '0px';
cursor.style.top = '0px';

document.addEventListener('mousemove', e => {
    cursorX = e.clientX;
    cursorY = e.clientY;
    if (document.body.classList.contains('logged-in') && settings.cursor) {
        cursor.style.left = cursorX + 'px';
        cursor.style.top = cursorY + 'px';
    }
});

document.addEventListener('mousedown', () => cursor.classList.add('click'));
document.addEventListener('mouseup', () => cursor.classList.remove('click'));

const bindHover = () => {
    const hoverElements = 'button,.desktop-icon,.start-item,.taskbar-icon,.window-btn,.theme-card,.bg-card,.item-card,.grid-btn,.link-btn,.nav-btn,.taskbar-window-btn,.taskbar-close-btn,.login-btn,a';
    $$(hoverElements).forEach(el => {
        el.addEventListener('mouseenter', () => {
            if (settings.cursor && document.body.classList.contains('logged-in')) {
                cursor.classList.add('hover');
            }
        });
        el.addEventListener('mouseleave', () => cursor.classList.remove('hover'));
    });
};

let unlockClicks = 0;
const unlockTrigger = $('#unlock-trigger');
const unlockStatus = $('#unlock-status');

if (unlockTrigger && unlockStatus) {
    unlockTrigger.addEventListener('click', function() {
        unlockClicks++;
        unlockStatus.textContent = `Click ${3-unlockClicks} more time${3-unlockClicks===1?'':'s'}`;
        this.style.transform = 'scale(0.95)';
        setTimeout(() => this.style.transform = '', 200);
        if (unlockClicks >= 3) {
            $('#disguise').classList.add('hide');
            setTimeout(() => {
                $('#disguise').style.display = 'none';
                $('#login-screen').classList.add('show');
                bindHover();
            }, 500);
        }
    });
}

let PROXIES = loadData('proxies', [
    {id:'truffled', name:'Truffled', icon:'üîµ', links:[
        {t:'Link 1', u:'https://educational.radissontucson.com/'},
        {t:'Link 2', u:'https://vacation.briaquaticcabinets.com/'}
    ]},
    {id:'overcloacked', name:'Overcloacked', icon:'‚ö°', links:[
        {t:'Link 1', u:'https://d58o0iyi.beanweb.qzz.io.cdn.cloudflare.net/'}
    ]},
    {id:'fern', name:'Fern', icon:'üåø', links:[
        {t:'Link 1', u:'https://apple1.vandrekalenderen.dk/'}
    ]},
    {id:'infamous', name:'Infamous', icon:'üî•', links:[
        {t:'Link 1', u:'https://team-anti-drugs.acgcotton.com/'}
    ]},
    {id:'void', name:'Void', icon:'üåå', links:[
        {t:'Link 1', u:'https://edu.ucecom-craiova.ro'}
    ]}
]);

let GAMES = loadData('games', [
    {id:'geometry-dash', icon:'üî∫', name:'Geometry Dash', cat:'Rhythm', url:'https://rawcdn.githack.com/genizy/google-class/main/gdlite/index.html'},
    {id:'draw-joust', icon:'‚öîÔ∏è', name:'Draw Joust', cat:'Action', url:'https://rawcdn.githack.com/genizy/brainrot/main/draw-joust/index.html'},
    {id:'code-editor', icon:'üíª', name:'Code Editor', cat:'Tools', url:'https://rawcdn.githack.com/genizy/code-editor/main/index.html'},
    {id:'destroy-the-car-3d', icon:'üöó', name:'Destroy The Car 3D', cat:'Action', url:'https://cdn.jsdelivr.net/gh/genizy/brainrot@main/destroy-the-car-3d/'},
    {id:'car-survival', icon:'üöó', name:'Car Survival 3D', cat:'Action', url:'https://rawcdn.githack.com/genizy/brainrot/main/car-survival-3d/index.html'},
    {id:'city-defense', icon:'üè∞', name:'City Defense 3D', cat:'Strategy', url:'https://rawcdn.githack.com/genizy/brainrot/main/city-defense/index.html'},
    {id:'build-army', icon:'ü™ñ', name:'Build a Big Army!', cat:'Strategy', url:'https://rawcdn.githack.com/genizy/brainrot/main/build-a-big-army/index.html'},
    {id:'soundboard', icon:'üîä', name:'Soundboard', cat:'Tools', url:'https://rawcdn.githack.com/genizy/soundboard/main/index.html'},
    {id:'fork-sausage', icon:'üç¥', name:'Fork N Sausage', cat:'Action', url:'https://rawcdn.githack.com/bubbls/youtube-playables/main/fork-n-sausage/index.html'},
    {id:'diamond-seeker', icon:'üíé', name:'Diamond Seeker', cat:'Puzzle', url:'https://rawcdn.githack.com/genizy/brainrot/main/diamond-seeker/'},
    {id:'elemental-masters', icon:'üî•', name:'Elemental Masters', cat:'Action', url:'https://cdn.jsdelivr.net/gh/genizy/brainrot@main/fire-and-frost-master/'},
    {id:'flick-goal', icon:'‚öΩ', name:'Flick Goal', cat:'Sports', url:'https://rawcdn.githack.com/genizy/brainrot/main/flick-goal/'},
    {id:'gun-clone', icon:'üî´', name:'Gun Clone', cat:'Action', url:'https://rawcdn.githack.com/genizy/brainrot/main/gun-clone/'},
    {id:'make-a-superboat', icon:'üö§', name:'Make a Superboat', cat:'Simulation', url:'https://rawcdn.githack.com/genizy/brainrot/main/make-a-superboat/'}
]);

let INSTALLED_APPS = loadData('installed_apps', []);
let NOTES = loadData('notes', []);

function updateClock() {
    const now = new Date();
    const time = now.toLocaleTimeString('en-US', {hour: '2-digit', minute: '2-digit'});
    const date = now.toLocaleDateString('en-US', {weekday: 'short', month: 'short', day: 'numeric'});
    const clockEl = $('#taskbar-clock');
    if (clockEl) {
        clockEl.querySelector('.clock-time').textContent = time;
        clockEl.querySelector('.clock-date').textContent = date;
    }
}
setInterval(updateClock, 1000);

const startBtn = $('#start-btn');
const startMenu = $('#start-menu');
const startSearchInput = $('#start-search-input');

if (startBtn) {
    startBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        startMenu.classList.toggle('show');
        if (startMenu.classList.contains('show')) {
            setTimeout(() => startSearchInput.focus(), 100);
        }
    });
}

// Search in start menu
if (startSearchInput) {
    startSearchInput.addEventListener('input', (e) => {
        const query = e.target.value.toLowerCase().trim();
        const allItems = $$('.start-item');
        
        if (query.length < 1) {
            allItems.forEach(item => item.style.display = '');
            return;
        }
        
        allItems.forEach(item => {
            const label = item.querySelector('.start-item-label').textContent.toLowerCase();
            if (label.includes(query)) {
                item.style.display = '';
            } else {
                item.style.display = 'none';
            }
        });
    });
}

function closeStartMenu() {
    if (startMenu) startMenu.classList.remove('show');
}

document.addEventListener('click', (e) => {
    if (startMenu.classList.contains('show') && !e.target.closest('#start-menu') && !e.target.closest('#start-btn')) {
        closeStartMenu();
    }
});

function getAppIcon(app) {
    const icons = {
        'dashboard': 'üìä', 'proxy-installer': 'üåê', 'game-installer': 'üéÆ',
        'styles': 'üé®', 'settings': '‚öôÔ∏è', 'files': 'üìÅ', 'calculator': 'üî¢',
        'notes': 'üìù'
    };
    return icons[app] || 'üìÅ';
}

let windows = [];
let windowIdCounter = 0;
let activeWindowId = null;

const createWindow = (title, icon, type, onContentReady) => {
    const id = `win-${windowIdCounter++}`;
    const win = document.createElement('div');
    win.className = 'window';
    win.id = id;
    win.style.top = (window.innerHeight / 2 - 300) + 'px';
    win.style.left = (window.innerWidth / 2 - 350) + 'px';
    win.style.width = '700px';
    win.style.height = '500px';
    win.innerHTML = `
        <div class="window-titlebar">
            <div class="window-title">${icon} ${title}</div>
            <div class="window-controls">
                <button class="window-btn minimize" title="Minimize">‚àí</button>
                <button class="window-btn maximize" title="Maximize">‚ñ°</button>
                <button class="window-btn close" title="Close">‚úï</button>
            </div>
        </div>
        <div class="tab-content active" id="content-${id}"></div>
    `;
    $('#windows-container').appendChild(win);
    initInteractWindow(win);
    win.querySelector('.close').addEventListener('click', () => closeWindow(id));
    win.querySelector('.minimize').addEventListener('click', () => minimizeWindow(id));
    win.querySelector('.maximize').addEventListener('click', () => toggleMaximize(id));
    win.addEventListener('mousedown', () => focusWindow(id));
    windows.push({id, title, icon, type, minimized: false});
    setTimeout(() => {
        win.classList.add('show');
        focusWindow(id);
        if (onContentReady) onContentReady($(`#content-${id}`));
    }, 50);
    updateTaskbarWindows();
    bindHover();
    return id;
};

function initInteractWindow(win) {
    let x = parseInt(win.style.left) || 0;
    let y = parseInt(win.style.top) || 0;
    let w = parseInt(win.style.width) || 700;
    let h = parseInt(win.style.height) || 500;
    interact(win).draggable({
        listeners: {
            start(event) {
                focusWindow(win.id);
                document.body.classList.add('dragging');
            },
            move(event) {
                if (!win.classList.contains('maximized')) {
                    x += event.dx;
                    y += event.dy;
                    win.style.left = `${x}px`;
                    win.style.top = `${y}px`;
                }
            },
            end() { document.body.classList.remove('dragging'); }
        }
    }).resizable({
        edges: { left: true, right: true, bottom: true, top: true },
        listeners: {
            start(event) {
                focusWindow(win.id);
                document.body.classList.add('resizing');
            },
            move(event) {
                if (!win.classList.contains('maximized')) {
                    x = event.rect.left;
                    y = event.rect.top;
                    w = event.rect.width;
                    h = event.rect.height;
                    Object.assign(win.style, {
                        width: `${w}px`, height: `${h}px`,
                        left: `${x}px`, top: `${y}px`
                    });
                }
            },
            end() { document.body.classList.remove('resizing'); }
        },
        modifiers: [interact.modifiers.restrictSize({ min: { width: 400, height: 300 } })]
    });
}

const closeWindow = (id) => {
    const win = $(`#${id}`);
    if (win) {
        win.classList.remove('show');
        setTimeout(() => win.remove(), 200);
    }
    windows = windows.filter(w => w.id !== id);
    updateTaskbarWindows();
};

const minimizeWindow = (id) => {
    const win = $(`#${id}`);
    if (win) {
        win.classList.add('minimized');
        const winData = windows.find(w => w.id === id);
        if (winData) winData.minimized = true;
    }
    updateTaskbarWindows();
};

const restoreWindow = (id) => {
    const win = $(`#${id}`);
    if (win) {
        win.classList.remove('minimized');
        const winData = windows.find(w => w.id === id);
        if (winData) winData.minimized = false;
        focusWindow(id);
    }
    updateTaskbarWindows();
};

const toggleMaximize = (id) => {
    const win = $(`#${id}`);
    if (win) win.classList.toggle('maximized');
};

const focusWindow = (id) => {
    $$('.window').forEach(w => w.style.zIndex = 100);
    const win = $(`#${id}`);
    if (win) win.style.zIndex = 101;
    activeWindowId = id;
    updateTaskbarWindows();
};

const updateTaskbarWindows = () => {
    const container = $('#taskbar-windows');
    if (!container) return;
    container.innerHTML = windows.map(w => `
        <div class="taskbar-window-btn ${w.id === activeWindowId && !w.minimized ? 'active' : ''}" data-id="${w.id}">
            <div class="taskbar-window-icon">${w.icon}</div>
            <div class="taskbar-window-title">${w.title}</div>
            <button class="taskbar-close-btn" data-id="${w.id}" title="Close window">‚úï</button>
        </div>
    `).join('');
    $$('.taskbar-window-btn').forEach(btn => {
        const id = btn.dataset.id;
        btn.addEventListener('click', (e) => {
            if (e.target.classList.contains('taskbar-close-btn')) return;
            const winData = windows.find(w => w.id === id);
            if (winData && winData.minimized) {
                restoreWindow(id);
            } else {
                focusWindow(id);
            }
        });
    });
    $$('.taskbar-close-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
            e.stopPropagation();
            const id = btn.dataset.id;
            closeWindow(id);
        });
    });
    bindHover();
};

function closeAllWindows() {
    windows.slice().forEach(w => closeWindow(w.id));
    toast('All Windows Closed', 'All windows have been closed');
}

const openApp = (appId) => {
    switch(appId) {
        case 'dashboard': openDashboardApp(); break;
        case 'proxy-installer': openProxyInstaller(); break;
        case 'game-installer': openGameInstaller(); break;
        case 'styles': openStylesApp(); break;
        case 'settings': openSettingsApp(); break;
        case 'files': openFilesApp(); break;
        case 'calculator': openCalculatorApp(); break;
        case 'notes': openNotesApp(); break;
    }
    closeStartMenu();
};

function installApp(appData) {
    const { type, data } = appData;
    const isInstalled = INSTALLED_APPS.some(app => 
        app.type === type && app.data.id === data.id
    );
    if (isInstalled) {
        toast('Already Installed', `${data.name} is already on your desktop`, 'error');
        return;
    }
    INSTALLED_APPS.push(appData);
    saveData('installed_apps', INSTALLED_APPS);
    createDesktopIcon(type, data);
    toast('Installed Successfully', `${data.name} has been added to your desktop`);
}

function createDesktopIcon(type, data) {
    const desktopIcons = $('.desktop-icons');
    if (!desktopIcons) return;
    const icon = document.createElement('div');
    icon.className = 'desktop-icon';
    icon.dataset.type = type;
    icon.dataset.id = data.id;
    icon.innerHTML = `
        <div class="desktop-icon-img">
            <div style="font-size: 32px;">${data.icon}</div>
        </div>
        <div class="desktop-icon-label">${data.name}</div>
    `;
    icon.addEventListener('click', () => {
        if (type === 'proxy') {
            openProxyUrl(data.name, data.icon, data.links[0].u);
        } else if (type === 'game') {
            openGame(data, true);
        }
    });
    desktopIcons.appendChild(icon);
    bindHover();
}

function loadInstalledApps() {
    INSTALLED_APPS.forEach(app => createDesktopIcon(app.type, app.data));
}

const openDashboardApp = () => {
    createWindow('Dashboard', 'üìä', 'dashboard', (content) => {
        content.innerHTML = `
            <div class="content-grid">
                <div class="grid-header">
                    <div>
                        <div class="grid-title">Dashboard</div>
                        <div class="grid-subtitle">Welcome to PeakOS v3.0, ${currentUser ? currentUser.username : 'User'}!</div>
                    </div>
                    <div class="grid-controls">
                        <button class="grid-btn primary" onclick="openApp('proxy-installer')">üåê Proxies</button>
                        <button class="grid-btn primary" onclick="openApp('game-installer')">üéÆ Games</button>
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin: 40px 0;">
                    <div class="item-card" onclick="openApp('proxy-installer')">
                        <div class="item-header">
                            <div class="item-icon">üåê</div>
                            <div class="item-content">
                                <div class="item-name">Proxy Installer</div>
                                <div class="item-desc">${PROXIES.length} proxies available</div>
                            </div>
                        </div>
                    </div>
                    <div class="item-card" onclick="openApp('game-installer')">
                        <div class="item-header">
                            <div class="item-icon">üéÆ</div>
                            <div class="item-content">
                                <div class="item-name">Game Installer</div>
                                <div class="item-desc">${GAMES.length} games available</div>
                            </div>
                        </div>
                    </div>
                    <div class="item-card" onclick="openApp('notes')">
                        <div class="item-header">
                            <div class="item-icon">üìù</div>
                            <div class="item-content">
                                <div class="item-name">Notes</div>
                                <div class="item-desc">${NOTES.length} saved notes</div>
                            </div>
                        </div>
                    </div>
                    <div class="item-card" onclick="openApp('files')">
                        <div class="item-header">
                            <div class="item-icon">üìÅ</div>
                            <div class="item-content">
                                <div class="item-name">File Manager</div>
                                <div class="item-desc">Browse your files</div>
                            </div>
                        </div>
                    </div>
                    <div class="item-card" onclick="openApp('calculator')">
                        <div class="item-header">
                            <div class="item-icon">üî¢</div>
                            <div class="item-content">
                                <div class="item-name">Calculator</div>
                                <div class="item-desc">Quick calculations</div>
                            </div>
                        </div>
                    </div>
                    <div class="item-card" onclick="openApp('styles')">
                        <div class="item-header">
                            <div class="item-icon">üé®</div>
                            <div class="item-content">
                                <div class="item-name">Styles</div>
                                <div class="item-desc">Customize appearance</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
        bindHover();
    });
};

const openProxyInstaller = () => {
    createWindow('Proxy Installer', 'üåê', 'proxy-installer', (content) => {
        content.innerHTML = `
            <div class="content-grid">
                <div class="grid-header">
                    <div>
                        <div class="grid-title">Proxy Installer</div>
                        <div class="grid-subtitle">${PROXIES.length} secure proxies</div>
                    </div>
                </div>
                <div class="item-grid">
                    ${PROXIES.map(p => {
                        const isInstalled = INSTALLED_APPS.some(app => 
                            app.type === 'proxy' && app.data.id === p.id
                        );
                        return `
                        <div class="item-card">
                            <div class="item-header">
                                <div class="item-icon">${p.icon}</div>
                                <div class="item-content">
                                    <div class="item-name">${p.name}</div>
                                    <div class="item-desc">${p.links.length} link${p.links.length>1?'s':''}</div>
                                </div>
                            </div>
                            <div class="item-actions">
                                <button class="grid-btn ${isInstalled ? '' : 'primary'}" style="font-size: 11px; padding: 8px 12px;"
                                        ${isInstalled ? 'disabled' : ''}
                                        onclick="installApp({type: 'proxy', data: window.PROXIES.find(proxy => proxy.id === '${p.id}')})">
                                    ${isInstalled ? '‚úì Installed' : 'Install'}
                                </button>
                            </div>
                            <div class="item-links">
                                ${p.links.map((link, index) => `
                                    <button class="link-btn" onclick="openProxyUrl('${p.name} - Link ${index + 1}', '${p.icon}', '${link.u}')">
                                        <span class="link-number">${index + 1}</span>
                                        Link ${index + 1}
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                    `}).join('')}
                </div>
            </div>
        `;
        bindHover();
    });
};

const openGameInstaller = () => {
    createWindow('Game Installer', 'üéÆ', 'game-installer', (content) => {
        content.innerHTML = `
            <div class="content-grid">
                <div class="grid-header">
                    <div>
                        <div class="grid-title">Game Installer</div>
                        <div class="grid-subtitle">${GAMES.length} games available</div>
                    </div>
                </div>
                <div class="item-grid">
                    ${GAMES.map(g => {
                        const isInstalled = INSTALLED_APPS.some(app => 
                            app.type === 'game' && app.data.id === g.id
                        );
                        return `
                        <div class="item-card">
                            <div class="item-header">
                                <div class="item-icon">${g.icon}</div>
                                <div class="item-content">
                                    <div class="item-name">${g.name}</div>
                                    <div class="item-desc">${g.cat}</div>
                                </div>
                            </div>
                            <div class="item-actions">
                                <button class="grid-btn ${isInstalled ? '' : 'primary'}" style="font-size: 11px; padding: 8px 12px;"
                                        ${isInstalled ? 'disabled' : ''}
                                        onclick="installApp({type: 'game', data: window.GAMES.find(game => game.id === '${g.id}')})">
                                    ${isInstalled ? '‚úì Installed' : 'Install'}
                                </button>
                                <button class="grid-btn" style="font-size: 11px; padding: 8px 12px;"
                                        onclick="openGame(window.GAMES.find(game => game.id === '${g.id}'), true)">
                                    üéÆ Play
                                </button>
                            </div>
                        </div>
                    `}).join('')}
                </div>
            </div>
        `;
        bindHover();
    });
};

const openStylesApp = () => {
    createWindow('Styles', 'üé®', 'styles', (content) => {
        content.innerHTML = `
            <div class="styles-content">
                <div class="styles-section">
                    <div class="styles-section-title">üé® Themes</div>
                    <div class="theme-grid">
                        ${['midnight', 'neon', 'aurora', 'sunset', 'cyber', 'matrix', 'space', 'ocean', 'fire', 'forest'].map(t => `
                            <div class="theme-card ${settings.theme===t?'active':''}" data-theme="${t}"
                                 style="--preview-bg: ${getThemeGradient(t)};">
                                <div class="theme-card-preview">${getThemeIcon(t)}</div>
                                <div class="theme-card-name">${t.charAt(0).toUpperCase()+t.slice(1)}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="styles-section">
                    <div class="styles-section-title">üñºÔ∏è Backgrounds</div>
                    <div class="bg-grid">
                        ${['gradient-1', 'gradient-2', 'gradient-3', 'gradient-4', 'gradient-5', 'gradient-6', 'gradient-7', 'gradient-8', 'stars', 'grid', 'waves', 'nebula', 'aurora'].map(b => `
                            <div class="bg-card ${settings.background===b?'active':''}" data-bg="${b}"
                                 style="--preview-bg: ${getBgPreview(b)};">
                                <div class="bg-card-preview"></div>
                                <div class="bg-card-name">${getBgName(b)}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
        `;
        $$('.theme-card').forEach(card => {
            card.addEventListener('click', () => {
                const theme = card.dataset.theme;
                $$('.theme-card').forEach(c => c.classList.remove('active'));
                card.classList.add('active');
                settings.theme = theme;
                saveData('settings', settings);
                document.body.className = document.body.className.replace(/theme-\w+/g, '');
                document.body.classList.add(`theme-${theme}`);
                toast('Theme Changed', `Switched to ${theme} theme`);
            });
        });
        $$('.bg-card').forEach(card => {
            card.addEventListener('click', () => {
                const bg = card.dataset.bg;
                $$('.bg-card').forEach(c => c.classList.remove('active'));
                card.classList.add('active');
                settings.background = bg;
                if (bg !== 'custom') settings.customBg = null;
                saveData('settings', settings);
                applyBackground(bg, settings.customBg);
                toast('Background Changed', getBgName(bg));
            });
        });
        bindHover();
    });
};

const openSettingsApp = () => {
    createWindow('Settings', '‚öôÔ∏è', 'settings', (content) => {
        content.innerHTML = `
            <div class="styles-content">
                <div class="styles-section">
                    <div class="styles-section-title">‚öôÔ∏è System Settings</div>
                    <div class="settings-controls">
                        ${[
                            {id:'cursor', label:'Custom Cursor', desc:'Enable/disable custom cursor'},
                            {id:'animations', label:'Animations', desc:'Enable/disable UI animations'},
                            {id:'notifications', label:'Notifications', desc:'Show toast notifications'},
                            {id:'contrast', label:'High Contrast', desc:'Increase contrast'},
                            {id:'font', label:'Large Font', desc:'Increase text size'},
                            {id:'performance', label:'Performance Mode', desc:'Disable effects'}
                        ].map(setting => `
                            <div class="setting-item">
                                <div class="setting-info">
                                    <h4>${setting.label}</h4>
                                    <p>${setting.desc}</p>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" id="setting-${setting.id}" ${settings[setting.id]?'checked':''}>
                                    <span class="slider"></span>
                                </label>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="styles-section">
                    <div class="styles-section-title">üë§ Account</div>
                    <div style="padding: 20px; background: var(--bg3); border-radius: 14px; text-align: center;">
                        <div style="font-size: 48px; margin-bottom: 16px;">üë§</div>
                        <div style="font-size: 18px; font-weight: 700; color: var(--txt); margin-bottom: 8px;">
                            ${currentUser ? currentUser.username : 'User'}
                        </div>
                        <div style="font-size: 13px; color: var(--txt2);">PeakOS Account</div>
                        <button class="grid-btn" style="margin-top: 20px; width: 100%;" onclick="logout()">
                            üîì Logout
                        </button>
                    </div>
                </div>
            </div>
        `;
        $$('.switch input').forEach(input => {
            input.addEventListener('change', function(e) {
                const setting = e.target.id.replace('setting-', '');
                settings[setting] = e.target.checked;
                saveData('settings', settings);
                applySettings();
                toast('Setting Updated', `${setting} ${e.target.checked?'enabled':'disabled'}`);
            });
        });
        bindHover();
    });
};

const openFilesApp = () => {
    createWindow('File Manager', 'üìÅ', 'files', (content) => {
        content.innerHTML = `
            <div class="content-grid">
                <div class="grid-header">
                    <div>
                        <div class="grid-title">File Manager</div>
                        <div class="grid-subtitle">Browse your files</div>
                    </div>
                </div>
                <div style="padding: 60px; text-align: center; color: var(--txt2);">
                    <div style="font-size: 64px; margin-bottom: 20px;">üìÅ</div>
                    <div style="font-size: 18px; font-weight: 600; margin-bottom: 10px;">No Files Yet</div>
                    <div style="font-size: 14px;">File management coming soon!</div>
                </div>
            </div>
        `;
    });
};

const openCalculatorApp = () => {
    createWindow('Calculator', 'üî¢', 'calculator', (content) => {
        content.innerHTML = `
            <div style="display: flex; flex-direction: column; height: 100%; background: var(--bg); padding: 24px;">
                <div style="background: var(--bg3); border-radius: 14px; padding: 24px; margin-bottom: 20px; text-align: right; font-size: 36px; font-family: 'Fira Code', monospace; color: var(--txt); min-height: 80px; display: flex; align-items: center; justify-content: flex-end; border: 2px solid var(--border);" id="calc-display">0</div>
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; flex: 1;">
                    ${['C', '‚Üê', '%', '√∑', '7', '8', '9', '√ó', '4', '5', '6', '-', '1', '2', '3', '+', '0', '.', '='].map(btn => `
                        <button class="grid-btn" style="font-size: 20px; min-height: 60px; ${btn==='='?'grid-column: span 2;':''}" onclick="calcBtn('${btn}')">${btn}</button>
                    `).join('')}
                </div>
            </div>
        `;
        bindHover();
    });
};

let calcValue = '0';
let calcOperator = null;
let calcPrevValue = null;

window.calcBtn = (btn) => {
    const display = $('#calc-display');
    if (!display) return;
    
    if (btn === 'C') {
        calcValue = '0';
        calcOperator = null;
        calcPrevValue = null;
    } else if (btn === '‚Üê') {
        calcValue = calcValue.slice(0, -1) || '0';
    } else if (['+', '-', '√ó', '√∑', '%'].includes(btn)) {
        calcOperator = btn;
        calcPrevValue = parseFloat(calcValue);
        calcValue = '0';
    } else if (btn === '=') {
        if (calcOperator && calcPrevValue !== null) {
            const current = parseFloat(calcValue);
            let result = 0;
            switch(calcOperator) {
                case '+': result = calcPrevValue + current; break;
                case '-': result = calcPrevValue - current; break;
                case '√ó': result = calcPrevValue * current; break;
                case '√∑': result = calcPrevValue / current; break;
                case '%': result = calcPrevValue % current; break;
            }
            calcValue = result.toString();
            calcOperator = null;
            calcPrevValue = null;
        }
    } else {
        if (calcValue === '0' && btn !== '.') {
            calcValue = btn;
        } else {
            calcValue += btn;
        }
    }
    
    display.textContent = calcValue;
};

const openNotesApp = () => {
    createWindow('Notes', 'üìù', 'notes', (content) => {
        content.innerHTML = `
            <div style="display: flex; height: 100%;">
                <div style="width: 250px; background: var(--bg3); border-right: 1px solid var(--border); display: flex; flex-direction: column;">
                    <div style="padding: 20px; border-bottom: 1px solid var(--border);">
                        <button class="grid-btn primary" style="width: 100%;" onclick="createNote()">üìù New Note</button>
                    </div>
                    <div style="flex: 1; overflow-y: auto; padding: 12px;" id="notes-list">
                        ${NOTES.length === 0 ? '<div style="padding: 20px; text-align: center; color: var(--txt2); font-size: 13px;">No notes yet</div>' : 
                        NOTES.map((note, i) => `
                            <div class="item-card" style="margin-bottom: 8px; padding: 12px; cursor: pointer;" onclick="openNote(${i})">
                                <div style="font-size: 13px; font-weight: 600; color: var(--txt); margin-bottom: 4px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${note.title || 'Untitled'}</div>
                                <div style="font-size: 11px; color: var(--txt2); overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${note.content.substring(0, 50)}...</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div style="flex: 1; display: flex; flex-direction: column; padding: 24px;">
                    <input type="text" id="note-title" placeholder="Note title..." style="background: var(--bg3); border: 2px solid var(--border); border-radius: 10px; padding: 14px; font-size: 18px; font-weight: 600; color: var(--txt); margin-bottom: 16px; font-family: 'Inter', sans-serif;">
                    <textarea id="note-content" placeholder="Start typing your note..." style="flex: 1; background: var(--bg3); border: 2px solid var(--border); border-radius: 10px; padding: 14px; font-size: 14px; color: var(--txt); resize: none; font-family: 'Inter', sans-serif; line-height: 1.6;"></textarea>
                    <button class="grid-btn primary" style="margin-top: 16px;" onclick="saveNote()">üíæ Save Note</button>
                </div>
            </div>
        `;
    });
};

let currentNoteIndex = null;

window.createNote = () => {
    currentNoteIndex = null;
    $('#note-title').value = '';
    $('#note-content').value = '';
    toast('New Note', 'Creating new note');
};

window.openNote = (index) => {
    currentNoteIndex = index;
    const note = NOTES[index];
    $('#note-title').value = note.title;
    $('#note-content').value = note.content;
};

window.saveNote = () => {
    const title = $('#note-title').value.trim() || 'Untitled';
    const content = $('#note-content').value.trim();
    
    if (!content) {
        toast('Error', 'Note content cannot be empty', 'error');
        return;
    }
    
    const note = { title, content, date: new Date().toISOString() };
    
    if (currentNoteIndex !== null) {
        NOTES[currentNoteIndex] = note;
        toast('Note Updated', 'Your note has been updated');
    } else {
        NOTES.push(note);
        toast('Note Saved', 'Your note has been saved');
    }
    
    saveData('notes', NOTES);
    
    // Refresh notes list
    const notesList = $('#notes-list');
    if (notesList) {
        notesList.innerHTML = NOTES.map((note, i) => `
            <div class="item-card" style="margin-bottom: 8px; padding: 12px; cursor: pointer;" onclick="openNote(${i})">
                <div style="font-size: 13px; font-weight: 600; color: var(--txt); margin-bottom: 4px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${note.title || 'Untitled'}</div>
                <div style="font-size: 11px; color: var(--txt2); overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${note.content.substring(0, 50)}...</div>
            </div>
        `).join('');
        bindHover();
    }
};

window.logout = () => {
    saveData('currentUser', null);
    location.reload();
};

function getThemeGradient(theme) {
    const grads = {
        midnight: 'linear-gradient(135deg,#0a0e27,#1e2749)',
        neon: 'linear-gradient(135deg,#000814,#001233,#ff00ff)',
        aurora: 'linear-gradient(135deg,#0a1a2d,#1f3a6d,#00ffaa)',
        sunset: 'linear-gradient(135deg,#1a0e1a,#3d2340,#ff6b35)',
        cyber: 'linear-gradient(135deg,#0d0d1a,#27274d,#00ffff)',
        matrix: 'linear-gradient(135deg,#000f00,#002500,#00ff00)',
        space: 'linear-gradient(135deg,#000016,#020246,#9370ff)',
        ocean: 'linear-gradient(135deg,#001f3f,#003366,#00a8ff)',
        fire: 'linear-gradient(135deg,#1a0a00,#331400,#ff4400)',
        forest: 'linear-gradient(135deg,#0a1a0a,#143314,#33cc33)'
    };
    return grads[theme] || grads.midnight;
}

function getThemeIcon(theme) {
    const icons = {midnight:'üåô', neon:'üí°', aurora:'üåà', sunset:'üåÖ', cyber:'ü§ñ', matrix:'üíö', space:'üöÄ', ocean:'üåä', fire:'üî•', forest:'üå≤'};
    return icons[theme] || 'üé®';
}

function getBgPreview(bg) {
    const previews = {
        'gradient-1': 'linear-gradient(135deg, #0a0e27, #1e2749)',
        'gradient-2': 'linear-gradient(135deg, #1a0e0a, #3d2318)',
        'gradient-3': 'linear-gradient(135deg, #0a1a0e, #1e3d27)',
        'gradient-4': 'linear-gradient(135deg, #140a1a, #351e3d)',
        'gradient-5': 'linear-gradient(135deg, #001f3f, #004080)',
        'gradient-6': 'linear-gradient(135deg, #1a0a00, #4d1f00)',
        'gradient-7': 'linear-gradient(135deg, #0a1a0a, #1f4d1f)',
        'gradient-8': 'linear-gradient(135deg, #1a001a, #4d004d)',
        'stars': '#000',
        'grid': 'repeating-linear-gradient(90deg, transparent, transparent 39px, rgba(255,255,255,0.1) 40px)',
        'waves': 'radial-gradient(circle at 20% 80%, rgba(0,212,255,0.2) 0%, transparent 50%)',
        'nebula': 'radial-gradient(ellipse at 30% 50%, rgba(147,51,234,0.3) 0%, transparent 50%)',
        'aurora': 'linear-gradient(180deg, transparent 40%, rgba(0,255,170,0.2) 60%, transparent 80%)'
    };
    return previews[bg] || '';
}

function getBgName(bg) {
    const names = {
        'gradient-1': 'Midnight Blue', 'gradient-2': 'Sunset Orange',
        'gradient-3': 'Forest Green', 'gradient-4': 'Royal Purple',
        'gradient-5': 'Ocean Deep', 'gradient-6': 'Fire Red',
        'gradient-7': 'Nature Green', 'gradient-8': 'Dark Purple',
        'stars': 'Starfield', 'grid': 'Grid Pattern', 'waves': 'Wave Mesh',
        'nebula': 'Nebula', 'aurora': 'Aurora'
    };
    return names[bg] || bg;
}

const openProxyUrl = (title, icon, url) => {
    createWindow(title, icon, 'browser', (content) => {
        content.innerHTML = `
            <div class="frame-navbar">
                <button class="nav-btn" onclick="this.closest('.window').querySelector('iframe').src = this.closest('.window').querySelector('iframe').src" title="Reload">‚Üª</button>
                <button class="nav-btn" onclick="window.open('${url}', '_blank')" title="Open in new tab">‚Üó</button>
            </div>
            <div class="content-frame">
                <div class="frame-loading">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">Loading ${title}...</div>
                </div>
                <div class="frame-error">
                    <div class="error-icon">‚ö†Ô∏è</div>
                    <div class="error-title">Failed to Load</div>
                    <div class="error-msg">This content couldn't be loaded. Try opening in a new tab.</div>
                    <button class="error-btn" onclick="window.open('${url}', '_blank')">Open in New Tab</button>
                </div>
                <iframe sandbox="allow-scripts allow-same-origin allow-popups allow-forms" 
                        allow="autoplay; fullscreen; microphone; camera"
                        referrerpolicy="no-referrer"
                        src="${url}"></iframe>
            </div>
        `;
        const iframe = content.querySelector('iframe');
        const loading = content.querySelector('.frame-loading');
        const error = content.querySelector('.frame-error');
        let loadTimeout = setTimeout(() => {
            loading.classList.add('hide');
            error.classList.add('show');
        }, 15000);
        iframe.addEventListener('load', () => {
            clearTimeout(loadTimeout);
            loading.classList.add('hide');
        });
        iframe.addEventListener('error', () => {
            clearTimeout(loadTimeout);
            loading.classList.add('hide');
            error.classList.add('show');
        });
        bindHover();
    });
};

const openGame = (game, newWindow = false) => {
    openProxyUrl(game.name, game.icon, game.url);
};

$$('.desktop-icon[data-app]').forEach(icon => {
    icon.addEventListener('click', () => {
        if (document.body.classList.contains('logged-in')) {
            openApp(icon.dataset.app);
        }
    });
});

$$('.start-item[data-app]').forEach(item => {
    item.addEventListener('click', () => {
        if (document.body.classList.contains('logged-in')) {
            openApp(item.dataset.app);
            closeStartMenu();
        }
    });
});

$$('.start-item[data-action]').forEach(item => {
    item.addEventListener('click', () => {
        if (item.dataset.action === 'close-all') {
            closeAllWindows();
            closeStartMenu();
        } else if (item.dataset.action === 'lock') {
            logout();
            closeStartMenu();
        }
    });
});

$('#close-all-btn').addEventListener('click', closeAllWindows);

const lockBtn = $('#lock-btn');
if (lockBtn) {
    lockBtn.addEventListener('click', () => {
        logout();
    });
}

document.addEventListener('keydown', e => {
    if (e.ctrlKey && e.shiftKey && e.key === 'L') {
        e.preventDefault();
        if (document.body.classList.contains('logged-in')) {
            logout();
        }
    }
    if (e.key === 'Escape') {
        closeStartMenu();
    }
    if (e.ctrlKey && e.key === 'w' && activeWindowId) {
        e.preventDefault();
        closeWindow(activeWindowId);
    }
    if (e.ctrlKey && e.shiftKey && e.key === 'W') {
        e.preventDefault();
        closeAllWindows();
    }
});

document.addEventListener('DOMContentLoaded', () => {
    initLoadingScreen();
    setTimeout(() => {
        const isLoggedIn = checkAuth();
        if (isLoggedIn) {
            $('#login-screen').style.display = 'none';
            document.body.classList.add('logged-in');
            updateClock();
            bindHover();
            loadInstalledApps();
            cursor.style.display = 'block';
            setTimeout(() => openApp('dashboard'), 1000);
        } else {
            initAuth();
        }
    }, 1500);
    setInterval(() => {
        if (unlockClicks > 0 && unlockClicks < 3) {
            unlockClicks = 0;
            if (unlockStatus) {
                unlockStatus.textContent = 'Click 3 times to unlock';
            }
        }
    }, 10000);
});

window.openApp = openApp;
window.openGame = openGame;
window.closeAllWindows = closeAllWindows;
window.installApp = installApp;
window.PROXIES = PROXIES;
window.GAMES = GAMES;
    </script>
</body>
</html>

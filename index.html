<!doctype html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PeakOS - Advanced Browser Environment</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><path d='M50 10 L70 50 L90 90 L10 90 L30 50 Z' fill='%2300d4ff'/><path d='M50 10 L60 30 L50 35 L40 30 Z' fill='%23fff'/></svg>" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto:wght@400;500;700&family=Fira+Code&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        :root {
            --bg: #0a0e27; --bg2: #151b3d; --bg3: #1e2749;
            --acc: #00d4ff; --txt: #e8eaf0; --txt2: #8b93b8;
            --border: rgba(255,255,255,0.08); --border-acc: rgba(0,212,255,0.4);
            --glow: rgba(0,212,255,0.2);
            --shadow-lg: 0 20px 60px rgba(0,0,0,0.7);
            --shadow-md: 0 8px 32px rgba(0,0,0,0.4);
        }
        
        /* ‚ïê‚ïê‚ïê THEME PRESETS ‚ïê‚ïê‚ïê */
        body.theme-midnight { 
            --bg: #0a0e27; --bg2: #151b3d; --bg3: #1e2749;
            --acc: #00d4ff; --glow: rgba(0,212,255,0.2);
            --acc-light: #6fe7ff; --acc-dark: #0099cc;
        }
        body.theme-neon { 
            --bg: #000814; --bg2: #001233; --bg3: #001845;
            --acc: #ff00ff; --glow: rgba(255,0,255,0.2);
            --acc-light: #ff66ff; --acc-dark: #cc00cc;
        }
        body.theme-aurora { 
            --bg: #0a1a2d; --bg2: #152a4d; --bg3: #1f3a6d;
            --acc: #00ffaa; --glow: rgba(0,255,170,0.2);
            --acc-light: #66ffcc; --acc-dark: #00cc88;
        }
        body.theme-sunset { 
            --bg: #1a0e1a; --bg2: #2d1830; --bg3: #3d2340;
            --acc: #ff6b35; --glow: rgba(255,107,53,0.2);
            --acc-light: #ff9d7a; --acc-dark: #cc5220;
        }
        body.theme-cyber { 
            --bg: #0d0d1a; --bg2: #1a1a33; --bg3: #27274d;
            --acc: #00ffff; --glow: rgba(0,255,255,0.2);
            --acc-light: #66ffff; --acc-dark: #00cccc;
        }
        body.theme-matrix { 
            --bg: #000f00; --bg2: #001a00; --bg3: #002500;
            --acc: #00ff00; --glow: rgba(0,255,0,0.2);
            --acc-light: #66ff66; --acc-dark: #00cc00;
        }
        body.theme-space { 
            --bg: #000016; --bg2: #01012e; --bg3: #020246;
            --acc: #9370ff; --glow: rgba(147,112,255,0.2);
            --acc-light: #b39bff; --acc-dark: #6a4fcc;
        }
        body.theme-fire { 
            --bg: #1a0500; --bg2: #330a00; --bg3: #4d0f00;
            --acc: #ff3300; --glow: rgba(255,51,0,0.2);
            --acc-light: #ff7a66; --acc-dark: #cc2900;
        }
        
        body.high-contrast { 
            --bg: #000; --bg2: #111; --bg3: #222; 
            --txt: #fff; --txt2: #aaa;
            --border: rgba(255,255,255,0.3);
        }
        body.reduced-motion * { animation: none !important; transition: none !important; }
        body.performance-mode #desktop-bg { display: none; }
        body.font-large { font-size: 18px; }
        body.no-cursor { cursor: default; }
        body.no-cursor #cursor { display: none; }
        
        html, body { width: 100%; height: 100%; font-family: 'Inter', 'Roboto', sans-serif; overflow: hidden; }
        body { background: var(--bg); color: var(--txt); transition: background-color 0.3s; }
        body.unlocked { cursor: none; }
        
        /* ‚ïê‚ïê‚ïê CUSTOM CURSOR ‚ïê‚ïê‚ïê */
        #cursor { position: fixed; left: 0; top: 0; pointer-events: none; z-index: 999999;
            transform: translate(-8px, -8px); display: none; mix-blend-mode: difference; }
        body.unlocked #cursor { display: block; }
        .c-pointer { width: 16px; height: 24px; position: relative; }
        .c-pointer::before { content: ''; position: absolute; top: 0; left: 0; width: 0; height: 0;
            border-left: 8px solid transparent; border-right: 8px solid transparent; border-bottom: 12px solid var(--acc);
            transform: rotate(-45deg); filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5)); }
        .c-pointer::after { content: ''; position: absolute; top: 0; left: 0; width: 0; height: 0;
            border-left: 5px solid transparent; border-right: 5px solid transparent; border-bottom: 9px solid var(--acc-light);
            transform: rotate(-45deg) translate(2px, 2px); }
        #cursor.hover .c-pointer::before { transform: rotate(-45deg) scale(1.2); }
        #cursor.click .c-pointer::before { transform: rotate(-45deg) scale(0.9); }
        
        /* ‚ïê‚ïê‚ïê BACKGROUND SYSTEM ‚ïê‚ïê‚ïê */
        #desktop-bg { position: fixed; inset: 0; z-index: 0; transition: background .5s ease; }
        #desktop-bg.bg-gradient-1 { background: linear-gradient(135deg, var(--bg) 0%, var(--bg3) 100%); }
        #desktop-bg.bg-gradient-2 { background: linear-gradient(135deg, #0a0e27 0%, #1e2749 50%, #00d4ff22 100%); }
        #desktop-bg.bg-gradient-3 { background: linear-gradient(135deg, #1a0e0a 0%, #3d2318 100%); }
        #desktop-bg.bg-gradient-4 { background: linear-gradient(135deg, #0a1a0e 0%, #1e3d27 100%); }
        #desktop-bg.bg-stars { background: #000 url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="400" height="400"><circle cx="50" cy="80" r="1.5" fill="white" opacity="0.9"/><circle cx="350" cy="150" r="1" fill="white" opacity="0.7"/><circle cx="200" cy="250" r="2" fill="white" opacity="0.8"/><circle cx="100" cy="350" r="1" fill="white" opacity="0.6"/><circle cx="300" cy="50" r="1.5" fill="white" opacity="0.9"/></svg>'); }
        #desktop-bg.bg-grid { background: linear-gradient(var(--border) 1px, transparent 1px),
            linear-gradient(90deg, var(--border) 1px, transparent 1px);
            background-size: 40px 40px; }
        #desktop-bg.bg-waves { background: 
            radial-gradient(circle at 20% 80%, rgba(0,212,255,0.1) 0%, transparent 50%),
            radial-gradient(circle at 80% 20%, rgba(168,85,247,0.1) 0%, transparent 50%),
            var(--bg); }
        #desktop-bg.bg-custom { background-size: cover; background-position: center; }
        
        .bg-logo-watermark { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            opacity: 0.04; pointer-events: none; text-align: center; }
        .bg-logo-watermark svg { width: 500px; height: 500px; filter: drop-shadow(0 0 20px rgba(0,212,255,0.3)); }
        .bg-logo-watermark .logo-text { font-family: 'Orbitron', sans-serif; font-size: 48px; font-weight: 900;
            color: var(--acc); text-shadow: 0 0 30px var(--glow); margin-top: -40px; letter-spacing: 8px; }
        
        /* ‚ïê‚ïê‚ïê DISGUISE ‚ïê‚ïê‚ïê */
        #disguise { position: fixed; inset: 0; z-index: 99999; background: #f5f7fa; 
            overflow-y: auto; font-family: -apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;
            transition: opacity .5s, transform .5s; cursor: default; }
        #disguise.hide { opacity: 0; transform: scale(1.02); pointer-events: none; }
        body.unlocked #disguise { display: none; }
        
        /* ‚ïê‚ïê‚ïê OS DESKTOP ‚ïê‚ïê‚ïê */
        #os { position: fixed; inset: 0; display: flex; flex-direction: column; opacity: 0;
            transition: opacity .6s; pointer-events: none; }
        body.unlocked #os { opacity: 1; pointer-events: auto; }
        
        #desktop { position: relative; z-index: 1; flex: 1; padding: 40px; overflow: hidden; }
        
        .desktop-icons { display: grid; grid-template-columns: repeat(auto-fill, 140px);
            gap: 30px; grid-auto-rows: 140px; }
        .desktop-icon { display: flex; flex-direction: column; align-items: center; gap: 12px;
            padding: 20px; border-radius: 16px; cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: rgba(255,255,255,0.03); border: 2px solid transparent; position: relative; }
        .desktop-icon:hover { background: rgba(255,255,255,0.08); border-color: var(--border-acc);
            transform: translateY(-5px) scale(1.05); box-shadow: var(--shadow-md); }
        .desktop-icon::after { content: ''; position: absolute; inset: 0; border-radius: 16px;
            background: linear-gradient(135deg, transparent, var(--glow), transparent); opacity: 0; transition: opacity 0.3s; }
        .desktop-icon:hover::after { opacity: 1; }
        .desktop-icon-img { width: 64px; height: 64px; display: flex; align-items: center; justify-content: center; }
        .desktop-icon-img svg { width: 100%; height: 100%; filter: drop-shadow(0 0 10px rgba(0,212,255,0.3)); }
        .desktop-icon-label { font-size: 14px; color: var(--txt); text-align: center; font-weight: 600;
            text-shadow: 0 1px 3px rgba(0,0,0,0.8); padding: 4px 8px; border-radius: 6px;
            background: rgba(0,0,0,0.4); backdrop-filter: blur(10px); }
        
        /* ‚ïê‚ïê‚ïê WINDOWS ‚ïê‚ïê‚ïê */
        .window { position: absolute; background: var(--bg2); border: 1px solid var(--border-acc);
            border-radius: 16px; box-shadow: var(--shadow-lg); display: flex; flex-direction: column;
            opacity: 0; pointer-events: none; min-width: 600px; min-height: 500px; overflow: hidden; }
        .window.show { opacity: 1; pointer-events: auto; z-index: 100; }
        .window.maximized { top: 0 !important; left: 0 !important; right: 0 !important; bottom: 56px !important;
            width: 100% !important; height: calc(100% - 56px) !important; border-radius: 0; }
        .window.minimized { opacity: 0; pointer-events: none; transform: translateY(100px); }
        .window.resizing { transition: none !important; }
        
        /* Window Tabs */
        .window-tabs { display: flex; background: var(--bg3); border-bottom: 1px solid var(--border);
            overflow-x: auto; padding-left: 8px; }
        .window-tab { display: flex; align-items: center; gap: 10px; padding: 12px 20px;
            background: transparent; border-right: 1px solid var(--border); cursor: pointer;
            transition: all 0.2s; min-width: 200px; position: relative; }
        .window-tab:hover { background: rgba(255,255,255,0.05); }
        .window-tab.active { background: var(--bg2); border-bottom: 2px solid var(--acc); }
        .window-tab-icon { font-size: 16px; flex-shrink: 0; }
        .window-tab-title { flex: 1; font-size: 13px; overflow: hidden; text-overflow: ellipsis;
            white-space: nowrap; color: var(--txt2); font-weight: 500; }
        .window-tab.active .window-tab-title { color: var(--txt); }
        .window-tab-close { font-size: 18px; opacity: 0.5; color: var(--txt2); padding: 4px;
            border-radius: 4px; transition: all 0.2s; display: flex; align-items: center; justify-content: center; }
        .window-tab:hover .window-tab-close { opacity: 1; }
        .window-tab-close:hover { background: rgba(239,68,68,0.2); color: #ef4444; }
        .window-tab-new { padding: 12px 20px; background: transparent; border: none;
            color: var(--txt2); cursor: pointer; font-size: 20px; transition: all 0.2s; }
        .window-tab-new:hover { background: rgba(255,255,255,0.05); color: var(--txt); }
        
        /* Window Title Bar */
        .window-titlebar { display: flex; align-items: center; gap: 12px; padding: 12px 16px;
            background: var(--bg3); border-bottom: 1px solid var(--border); cursor: move;
            user-select: none; }
        .window-title { flex: 1; font-size: 14px; font-weight: 600; color: var(--txt); }
        .window-controls { display: flex; gap: 8px; }
        .window-btn { width: 32px; height: 32px; border-radius: 8px; background: transparent;
            border: 1px solid var(--border); color: var(--txt2); cursor: pointer; font-size: 14px;
            display: flex; align-items: center; justify-content: center; transition: all 0.2s; }
        .window-btn:hover { background: rgba(255,255,255,0.1); color: var(--txt); }
        .window-btn.close:hover { background: #ef4444; color: #fff; border-color: #ef4444; }
        
        /* Resize Handles */
        .window-resize-handle { position: absolute; z-index: 1000; }
        .window-resize-n { top: 0; left: 10px; right: 10px; height: 4px; cursor: n-resize; }
        .window-resize-s { bottom: 0; left: 10px; right: 10px; height: 4px; cursor: s-resize; }
        .window-resize-e { top: 10px; right: 0; bottom: 10px; width: 4px; cursor: e-resize; }
        .window-resize-w { top: 10px; left: 0; bottom: 10px; width: 4px; cursor: w-resize; }
        .window-resize-ne { top: 0; right: 0; width: 15px; height: 15px; cursor: ne-resize; }
        .window-resize-nw { top: 0; left: 0; width: 15px; height: 15px; cursor: nw-resize; }
        .window-resize-se { bottom: 0; right: 0; width: 15px; height: 15px; cursor: se-resize; }
        .window-resize-sw { bottom: 0; left: 0; width: 15px; height: 15px; cursor: sw-resize; }
        
        /* Tab Content */
        .tab-content { display: none; flex: 1; overflow: hidden; position: relative; }
        .tab-content.active { display: flex; flex-direction: column; }
        
        /* Iframe Content */
        .content-frame { flex: 1; background: #000; position: relative; }
        .content-frame iframe { width: 100%; height: 100%; border: none; }
        
        .frame-navbar { display: flex; align-items: center; gap: 12px; padding: 12px 16px;
            background: var(--bg3); border-bottom: 1px solid var(--border); }
        .nav-btn { width: 36px; height: 36px; border-radius: 8px; background: rgba(255,255,255,0.05);
            border: 1px solid var(--border); color: var(--txt2); cursor: pointer; display: flex;
            align-items: center; justify-content: center; transition: all 0.2s; }
        .nav-btn:hover { background: rgba(255,255,255,0.1); color: var(--txt); }
        .nav-url { flex: 1; background: rgba(255,255,255,0.05); border: 1px solid var(--border);
            border-radius: 8px; padding: 10px 16px; color: var(--txt); font-size: 13px;
            font-family: 'Fira Code', monospace; }
        .nav-go { padding: 10px 20px; background: var(--acc); color: var(--bg); border: none;
            border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        .nav-go:hover { background: var(--acc-light); transform: translateY(-1px); }
        
        .frame-loading { position: absolute; inset: 0; display: flex; flex-direction: column;
            align-items: center; justify-content: center; gap: 20px; background: #000;
            z-index: 10; transition: opacity .3s; }
        .frame-loading.hide { opacity: 0; pointer-events: none; }
        .loading-spinner { width: 56px; height: 56px; border: 4px solid var(--bg3);
            border-top-color: var(--acc); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading-text { font-size: 14px; color: var(--txt2); font-family: 'Fira Code',monospace; }
        
        .frame-error { display: none; flex-direction: column; align-items: center;
            justify-content: center; gap: 20px; padding: 60px; text-align: center; }
        .frame-error.show { display: flex; }
        .error-icon { font-size: 72px; }
        .error-title { font-size: 20px; font-weight: 700; color: var(--txt); }
        .error-msg { font-size: 14px; color: var(--txt2); max-width: 400px; line-height: 1.6; }
        .error-btn { padding: 12px 32px; background: var(--acc); color: var(--bg); border: none;
            border-radius: 10px; font-weight: 600; cursor: pointer; transition: all .2s; }
        .error-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 20px var(--glow); }
        
        /* Grid Content */
        .content-grid { flex: 1; overflow-y: auto; padding: 32px; }
        .content-grid::-webkit-scrollbar { width: 10px; }
        .content-grid::-webkit-scrollbar-thumb { background: var(--border-acc); border-radius: 5px; }
        .content-grid::-webkit-scrollbar-track { background: var(--bg3); }
        
        .grid-header { margin-bottom: 32px; display: flex; justify-content: space-between; align-items: center; }
        .grid-title { font-size: 32px; font-weight: 900; color: var(--txt); font-family: 'Orbitron',sans-serif;
            background: linear-gradient(135deg, var(--acc), var(--acc-light)); -webkit-background-clip: text;
            -webkit-text-fill-color: transparent; text-shadow: 0 0 30px var(--glow); }
        .grid-subtitle { font-size: 14px; color: var(--txt2); margin-top: 8px; }
        
        .grid-controls { display: flex; gap: 12px; }
        .grid-btn { padding: 10px 20px; background: var(--bg3); border: 1px solid var(--border);
            border-radius: 10px; color: var(--txt); cursor: pointer; transition: all 0.2s;
            display: flex; align-items: center; gap: 8px; font-weight: 500; }
        .grid-btn:hover { background: rgba(255,255,255,0.05); border-color: var(--border-acc); }
        .grid-btn.primary { background: var(--acc); color: var(--bg); border-color: var(--acc); }
        .grid-btn.primary:hover { background: var(--acc-light); transform: translateY(-1px); }
        
        .item-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .item-card { background: var(--bg3); border: 1px solid var(--border); border-radius: 16px;
            padding: 24px; cursor: pointer; transition: all 0.3s; display: flex; flex-direction: column;
            gap: 16px; position: relative; overflow: hidden; }
        .item-card::before { content: ''; position: absolute; inset: 0; background: linear-gradient(135deg, var(--glow), transparent); opacity: 0; transition: opacity 0.3s; }
        .item-card:hover::before { opacity: 0.3; }
        .item-card:hover { border-color: var(--border-acc); transform: translateY(-4px);
            box-shadow: var(--shadow-md); }
        .item-header { display: flex; align-items: center; gap: 16px; }
        .item-icon { font-size: 40px; }
        .item-content { flex: 1; }
        .item-name { font-size: 18px; font-weight: 700; color: var(--txt); }
        .item-desc { font-size: 13px; color: var(--txt2); margin-top: 6px; line-height: 1.5; }
        .item-links { display: flex; gap: 8px; margin-top: 12px; }
        .link-btn { padding: 6px 12px; background: rgba(255,255,255,0.05); border: 1px solid var(--border);
            border-radius: 6px; font-size: 12px; color: var(--txt2); cursor: pointer; transition: all 0.2s; }
        .link-btn:hover { background: var(--glow); color: var(--txt); }
        .item-actions { display: flex; gap: 8px; margin-top: 16px; }
        .action-btn { padding: 8px 16px; background: rgba(255,255,255,0.05); border: 1px solid var(--border);
            border-radius: 8px; font-size: 12px; color: var(--txt2); cursor: pointer; transition: all 0.2s; }
        .action-btn:hover { background: var(--glow); color: var(--txt); }
        .action-btn.delete:hover { background: rgba(239,68,68,0.2); color: #ef4444; }
        
        /* Search Results */
        .search-results { position: absolute; top: 100%; left: 0; right: 0; max-height: 500px;
            overflow-y: auto; background: var(--bg2); border: 1px solid var(--border-acc);
            border-radius: 0 0 16px 16px; box-shadow: var(--shadow-lg); display: none; z-index: 999; }
        .search-results.show { display: block; }
        .search-result-item { padding: 16px 20px; display: flex; align-items: center; gap: 16px;
            cursor: pointer; transition: all .15s; border-bottom: 1px solid var(--border); }
        .search-result-item:hover { background: var(--glow); }
        .search-result-item:last-child { border-bottom: none; }
        .search-result-icon { font-size: 28px; }
        .search-result-content { flex: 1; }
        .search-result-title { font-size: 14px; font-weight: 600; color: var(--txt); }
        .search-result-type { font-size: 12px; color: var(--txt2); margin-top: 4px; }
        
        /* Styles App */
        .styles-content { flex: 1; overflow-y: auto; padding: 32px; }
        .styles-section { margin-bottom: 40px; }
        .styles-section-title { font-size: 14px; font-weight: 700; text-transform: uppercase;
            letter-spacing: .1em; color: var(--txt2); margin-bottom: 20px;
            padding-bottom: 12px; border-bottom: 1px solid var(--border); }
        
        .theme-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 20px; }
        .theme-card { aspect-ratio: 16/9; border-radius: 16px; cursor: pointer; position: relative;
            overflow: hidden; border: 3px solid var(--border); transition: all 0.3s; }
        .theme-card.active { border-color: var(--acc); box-shadow: 0 0 0 3px var(--glow); }
        .theme-card:hover { transform: scale(1.05); }
        .theme-card-preview { width: 100%; height: 100%; display: flex; align-items: center;
            justify-content: center; font-size: 40px; background: var(--preview-bg); }
        .theme-card-name { position: absolute; bottom: 0; left: 0; right: 0;
            background: rgba(0,0,0,0.9); backdrop-filter: blur(10px); padding: 12px;
            font-size: 13px; font-weight: 600; text-align: center; }
        
        .bg-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; }
        .bg-card { aspect-ratio: 16/9; border-radius: 16px; cursor: pointer; position: relative;
            overflow: hidden; border: 3px solid var(--border); transition: all 0.3s; }
        .bg-card.active { border-color: var(--acc); box-shadow: 0 0 0 3px var(--glow); }
        .bg-card:hover { transform: scale(1.05); }
        .bg-card-preview { width: 100%; height: 100%; background: var(--preview-bg); }
        .bg-card-name { position: absolute; bottom: 0; left: 0; right: 0;
            background: rgba(0,0,0,0.9); backdrop-filter: blur(10px); padding: 12px;
            font-size: 13px; font-weight: 600; text-align: center; }
        
        .custom-bg-section { background: var(--bg3); border: 2px dashed var(--border);
            border-radius: 16px; padding: 32px; text-align: center; margin-top: 20px; }
        .custom-bg-preview { width: 100%; max-width: 400px; aspect-ratio: 16/9; margin: 0 auto 20px;
            border-radius: 12px; overflow: hidden; background: var(--bg); border: 2px solid var(--border); }
        .custom-bg-preview img { width: 100%; height: 100%; object-fit: cover; }
        .custom-bg-controls { display: flex; gap: 12px; justify-content: center; margin-top: 20px; }
        
        /* Settings Controls */
        .settings-controls { display: flex; flex-direction: column; gap: 16px; margin-top: 20px; }
        .setting-item { display: flex; justify-content: space-between; align-items: center;
            padding: 16px; background: var(--bg3); border: 1px solid var(--border);
            border-radius: 12px; transition: all 0.2s; }
        .setting-item:hover { border-color: var(--border-acc); }
        .setting-info h4 { font-size: 14px; font-weight: 600; color: var(--txt); }
        .setting-info p { font-size: 12px; color: var(--txt2); margin-top: 4px; }
        
        .switch { position: relative; display: inline-block; width: 52px; height: 28px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; inset: 0; background-color: var(--bg);
            border: 1px solid var(--border); transition: .4s; border-radius: 28px; }
        .slider:before { position: absolute; content: ""; height: 20px; width: 20px;
            left: 4px; bottom: 3px; background-color: var(--txt2); transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--acc); border-color: var(--acc); }
        input:checked + .slider:before { transform: translateX(24px); background-color: white; }
        
        /* Form for adding new items */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); backdrop-filter: blur(10px);
            z-index: 1000; display: none; align-items: center; justify-content: center; }
        .modal-overlay.show { display: flex; }
        .modal { background: var(--bg2); border: 1px solid var(--border-acc); border-radius: 20px;
            padding: 32px; max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto;
            box-shadow: var(--shadow-lg); }
        .modal-header { margin-bottom: 24px; }
        .modal-title { font-size: 24px; font-weight: 700; color: var(--txt); }
        .modal-close { position: absolute; top: 20px; right: 20px; background: none; border: none;
            color: var(--txt2); font-size: 24px; cursor: pointer; }
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; font-size: 14px; font-weight: 600; color: var(--txt);
            margin-bottom: 8px; }
        .form-input { width: 100%; padding: 12px 16px; background: var(--bg3); border: 1px solid var(--border);
            border-radius: 10px; color: var(--txt); font-size: 14px; transition: all 0.2s; }
        .form-input:focus { outline: none; border-color: var(--acc); box-shadow: 0 0 0 3px var(--glow); }
        .form-textarea { min-height: 100px; resize: vertical; }
        .form-buttons { display: flex; gap: 12px; justify-content: flex-end; margin-top: 32px; }
        
        /* ‚ïê‚ïê‚ïê TASKBAR ‚ïê‚ïê‚ïê */
        #taskbar { position: fixed; bottom: 0; left: 0; right: 0; height: 64px; z-index: 200;
            background: rgba(21,27,61,0.95); backdrop-filter: blur(20px);
            border-top: 1px solid var(--border-acc); display: flex; align-items: center;
            padding: 0 20px; gap: 16px; box-shadow: 0 -4px 20px rgba(0,0,0,0.4); }
        
        .taskbar-start { display: flex; align-items: center; gap: 16px; }
        .start-btn { width: 52px; height: 52px; border-radius: 14px;
            background: linear-gradient(135deg, var(--acc), var(--acc-dark)); border: none;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
            transition: all 0.3s; box-shadow: 0 4px 20px var(--glow); }
        .start-btn:hover { transform: scale(1.1) rotate(10deg); box-shadow: 0 6px 30px var(--glow); }
        .start-btn svg { width: 32px; height: 32px; }
        
        .search-taskbar { flex: 1; max-width: 600px; background: var(--bg3);
            border: 1px solid var(--border); border-radius: 30px; padding: 12px 24px;
            display: flex; align-items: center; gap: 12px; transition: all 0.3s; position: relative; }
        .search-taskbar:focus-within { border-color: var(--border-acc); box-shadow: 0 0 0 3px var(--glow); }
        .search-taskbar input { flex: 1; background: transparent; border: none; outline: none;
            color: var(--txt); font-size: 14px; font-family: 'Inter', sans-serif; }
        .search-taskbar input::placeholder { color: var(--txt2); }
        
        .taskbar-windows { display: flex; gap: 8px; flex: 1; overflow-x: auto; padding: 0 16px; }
        .taskbar-window-btn { padding: 10px 20px; background: var(--bg3); border: 1px solid var(--border);
            border-radius: 10px; cursor: pointer; transition: all 0.2s; display: flex;
            align-items: center; gap: 10px; min-width: 180px; max-width: 220px; }
        .taskbar-window-btn:hover { background: rgba(255,255,255,0.08); }
        .taskbar-window-btn.active { background: var(--glow); border-color: var(--border-acc); }
        .taskbar-window-icon { font-size: 18px; }
        .taskbar-window-title { flex: 1; font-size: 13px; font-weight: 500; overflow: hidden;
            text-overflow: ellipsis; white-space: nowrap; color: var(--txt2); }
        .taskbar-window-btn.active .taskbar-window-title { color: var(--txt); }
        
        .taskbar-end { display: flex; align-items: center; gap: 16px; margin-left: auto; }
        .taskbar-icon { width: 44px; height: 44px; border-radius: 12px; background: transparent;
            border: 1px solid transparent; cursor: pointer; display: flex; align-items: center;
            justify-content: center; transition: all 0.2s; color: var(--txt2); font-size: 20px; }
        .taskbar-icon:hover { background: rgba(255,255,255,0.1); color: var(--txt); }
        
        .taskbar-clock { padding: 10px 20px; text-align: center; cursor: pointer;
            border-radius: 10px; transition: all 0.2s; }
        .taskbar-clock:hover { background: rgba(255,255,255,0.05); }
        .clock-time { font-size: 16px; font-weight: 700; color: var(--txt);
            font-family: 'Fira Code',monospace; letter-spacing: 1px; }
        .clock-date { font-size: 12px; color: var(--txt2); margin-top: 4px; }
        
        /* ‚ïê‚ïê‚ïê START MENU ‚ïê‚ïê‚ïê */
        #start-menu { position: fixed; bottom: 80px; left: 20px; width: 720px; height: 760px;
            background: var(--bg2); border: 1px solid var(--border-acc); border-radius: 20px;
            box-shadow: var(--shadow-lg); display: flex; flex-direction: column;
            opacity: 0; pointer-events: none; transition: all 0.3s; transform: translateY(30px); }
        #start-menu.show { opacity: 1; pointer-events: auto; transform: translateY(0); z-index: 199; }
        
        .start-header { padding: 32px; border-bottom: 1px solid var(--border); display: flex;
            align-items: center; gap: 20px; position: relative; }
        .start-logo { width: 64px; height: 64px; position: relative; }
        .start-logo svg { width: 100%; height: 100%; filter: drop-shadow(0 0 20px rgba(0,212,255,0.5)); }
        .start-brand { flex: 1; }
        .start-title { font-size: 36px; font-weight: 900; font-family: 'Orbitron',sans-serif;
            background: linear-gradient(135deg, var(--acc), var(--acc-light));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            text-shadow: 0 0 40px var(--glow); letter-spacing: 2px; }
        .start-subtitle { font-size: 14px; color: var(--txt2); margin-top: 8px; }
        .start-version { position: absolute; top: 32px; right: 32px; font-size: 12px; color: var(--txt2); }
        
        .start-content { flex: 1; overflow-y: auto; padding: 28px; display: grid; grid-template-columns: 1fr 1fr; gap: 32px; }
        .start-section { margin-bottom: 32px; }
        .start-section-title { font-size: 12px; font-weight: 700; text-transform: uppercase;
            letter-spacing: .1em; color: var(--txt2); margin-bottom: 16px;
            padding-bottom: 8px; border-bottom: 1px solid var(--border); }
        
        .start-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; }
        .start-item { background: var(--bg3); border: 1px solid var(--border); border-radius: 16px;
            padding: 24px 16px; cursor: pointer; transition: all 0.3s; display: flex;
            flex-direction: column; align-items: center; gap: 12px; text-align: center; }
        .start-item:hover { background: var(--glow); border-color: var(--border-acc);
            transform: translateY(-4px); }
        .start-item-icon { font-size: 36px; }
        .start-item-label { font-size: 13px; font-weight: 600; color: var(--txt); }
        
        .start-quick-links { display: flex; flex-direction: column; gap: 12px; }
        .quick-link { padding: 16px; background: var(--bg3); border: 1px solid var(--border);
            border-radius: 12px; display: flex; align-items: center; gap: 12px;
            cursor: pointer; transition: all 0.2s; }
        .quick-link:hover { background: rgba(255,255,255,0.05); }
        .quick-link-icon { font-size: 20px; }
        .quick-link-text { flex: 1; font-size: 14px; font-weight: 500; color: var(--txt); }
        
        /* ‚ïê‚ïê‚ïê TOAST ‚ïê‚ïê‚ïê */
        .toast { position: fixed; top: 24px; right: 24px; z-index: 9999;
            background: var(--bg2); border: 1px solid var(--border-acc); border-radius: 16px;
            padding: 20px 24px; min-width: 320px; box-shadow: var(--shadow-lg);
            transform: translateX(400px); transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            display: flex; align-items: center; gap: 16px; }
        .toast.show { transform: translateX(0); }
        .toast-icon { font-size: 28px; }
        .toast-content { flex: 1; }
        .toast-title { font-size: 15px; font-weight: 700; color: var(--txt); }
        .toast-msg { font-size: 13px; color: var(--txt2); margin-top: 4px; line-height: 1.4; }
        .toast.success { border-color: rgba(34,197,94,0.4); }
        .toast.error { border-color: rgba(239,68,68,0.4); }
        
        /* ‚ïê‚ïê‚ïê CONTEXT MENU ‚ïê‚ïê‚ïê */
        #context-menu { position: fixed; min-width: 240px; background: var(--bg2);
            border: 1px solid var(--border-acc); border-radius: 16px; padding: 12px;
            box-shadow: var(--shadow-lg); opacity: 0; pointer-events: none;
            transition: opacity .2s; z-index: 9998; }
        #context-menu.show { opacity: 1; pointer-events: auto; }
        .context-item { padding: 12px 16px; border-radius: 10px; cursor: pointer;
            display: flex; align-items: center; gap: 14px; font-size: 14px;
            color: var(--txt); transition: all .15s; }
        .context-item:hover { background: var(--glow); }
        .context-icon { font-size: 18px; width: 24px; text-align: center; }
        
        @media(max-width: 1024px) {
            #start-menu { width: calc(100% - 40px); height: 80vh; }
            .start-grid { grid-template-columns: repeat(2, 1fr); }
            .item-grid { grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); }
        }
        
        @media(max-width: 768px) {
            .desktop-icons { grid-template-columns: repeat(auto-fill, 120px); gap: 20px; }
            .window { min-width: 100% !important; min-height: 400px !important; }
            .start-content { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body class="theme-midnight">

    <!-- CUSTOM CURSOR -->
    <div id="cursor">
        <div class="c-pointer"></div>
    </div>

    <!-- DISGUISE -->
    <div id="disguise">
        <div class="edu-wrap">
            <div class="edu-header">
                <div class="edu-logo">HS</div>
                <div class="edu-brand">
                    <h1>Hillside Secondary School</h1>
                    <p>Student Academic Portal ‚Ä¢ Hillside District</p>
                </div>
            </div>
            
            <section class="edu-hero">
                <div>
                    <h2>Welcome Back, Student!</h2>
                    <p>Access your classes, view assignments, and connect with teachers through our integrated learning platform.</p>
                </div>
                <div>
                    <button id="unlock-trigger">
                        üîì Initialize Session
                        <div class="unlock-status" id="unlock-status">Click 3 times to unlock</div>
                    </button>
                </div>
            </section>
        </div>
    </div>

    <!-- OS ENVIRONMENT -->
    <div id="os">
        <!-- Desktop Background -->
        <div id="desktop-bg" class="bg-gradient-1">
            <canvas id="bg-canvas"></canvas>
            <div class="bg-logo-watermark">
                <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <linearGradient id="logoGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:var(--acc);stop-opacity:1" />
                            <stop offset="50%" style="stop-color:var(--acc-light);stop-opacity:0.8" />
                            <stop offset="100%" style="stop-color:var(--acc-dark);stop-opacity:0.6" />
                        </linearGradient>
                        <filter id="glow">
                            <feGaussianBlur stdDeviation="4" result="coloredBlur"/>
                            <feMerge>
                                <feMergeNode in="coloredBlur"/>
                                <feMergeNode in="SourceGraphic"/>
                            </feMerge>
                        </filter>
                    </defs>
                    <path d="M 50 10 L 70 50 L 90 90 L 10 90 L 30 50 Z" fill="url(#logoGrad)" filter="url(#glow)"/>
                    <path d="M 50 10 L 60 30 L 50 35 L 40 30 Z" fill="#ffffff" filter="url(#glow)"/>
                </svg>
                <div class="logo-text">PEAK</div>
            </div>
        </div>
        
        <!-- Desktop Area -->
        <div id="desktop">
            <div class="desktop-icons">
                <div class="desktop-icon" data-app="dashboard">
                    <div class="desktop-icon-img">
                        <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                            <rect x="15" y="15" width="20" height="20" rx="4" fill="currentColor"/>
                            <rect x="45" y="15" width="20" height="20" rx="4" fill="currentColor"/>
                            <rect x="75" y="15" width="20" height="20" rx="4" fill="currentColor"/>
                            <rect x="15" y="45" width="20" height="40" rx="4" fill="currentColor"/>
                            <rect x="45" y="45" width="20" height="40" rx="4" fill="currentColor"/>
                            <rect x="75" y="45" width="20" height="40" rx="4" fill="currentColor"/>
                        </svg>
                    </div>
                    <div class="desktop-icon-label">Dashboard</div>
                </div>
                <div class="desktop-icon" data-app="hub">
                    <div class="desktop-icon-img">
                        <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="50" cy="50" r="40" fill="none" stroke="currentColor" stroke-width="4"/>
                            <circle cx="50" cy="50" r="10" fill="currentColor"/>
                            <line x1="50" y1="50" x2="50" y2="15" stroke="currentColor" stroke-width="4"/>
                            <line x1="50" y1="50" x2="85" y2="50" stroke="currentColor" stroke-width="4"/>
                            <line x1="50" y1="50" x2="50" y2="85" stroke="currentColor" stroke-width="4"/>
                            <line x1="50" y1="50" x2="15" y2="50" stroke="currentColor" stroke-width="4"/>
                        </svg>
                    </div>
                    <div class="desktop-icon-label">Proxy Hub</div>
                </div>
                <div class="desktop-icon" data-app="games">
                    <div class="desktop-icon-img">
                        <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                            <rect x="15" y="30" width="70" height="40" rx="10" fill="none" stroke="currentColor" stroke-width="4"/>
                            <circle cx="35" cy="50" r="8" fill="currentColor"/>
                            <circle cx="65" cy="45" r="6" fill="currentColor"/>
                            <circle cx="75" cy="55" r="6" fill="currentColor"/>
                        </svg>
                    </div>
                    <div class="desktop-icon-label">Games</div>
                </div>
                <div class="desktop-icon" data-app="styles">
                    <div class="desktop-icon-img">
                        <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="50" cy="35" r="18" fill="none" stroke="currentColor" stroke-width="4"/>
                            <path d="M 35 45 Q 25 60 30 75 L 70 75 Q 75 60 65 45" fill="currentColor"/>
                        </svg>
                    </div>
                    <div class="desktop-icon-label">Styles</div>
                </div>
                <div class="desktop-icon" data-app="partners">
                    <div class="desktop-icon-img">
                        <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                            <path d="M 50 20 L 70 40 L 90 35 L 85 60 L 95 80 L 70 75 L 50 90 L 30 75 L 5 80 L 15 60 L 10 35 L 30 40 Z" fill="currentColor"/>
                        </svg>
                    </div>
                    <div class="desktop-icon-label">Partners</div>
                </div>
                <div class="desktop-icon" data-app="updates">
                    <div class="desktop-icon-img">
                        <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="50" cy="50" r="40" fill="none" stroke="currentColor" stroke-width="4"/>
                            <circle cx="50" cy="30" r="5" fill="currentColor"/>
                            <circle cx="50" cy="50" r="5" fill="currentColor"/>
                            <circle cx="50" cy="70" r="5" fill="currentColor"/>
                        </svg>
                    </div>
                    <div class="desktop-icon-label">Updates</div>
                </div>
            </div>
        </div>
        
        <!-- Window Container -->
        <div id="windows-container"></div>
        
        <!-- Modal for adding new items -->
        <div class="modal-overlay" id="add-proxy-modal">
            <div class="modal">
                <button class="modal-close">&times;</button>
                <div class="modal-header">
                    <div class="modal-title">Add New Proxy</div>
                </div>
                <form id="add-proxy-form">
                    <div class="form-group">
                        <label class="form-label">Proxy Name</label>
                        <input type="text" class="form-input" name="name" placeholder="Enter proxy name" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Icon</label>
                        <input type="text" class="form-input" name="icon" placeholder="Emoji or icon code" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Links (one per line, format: Display Name|URL)</label>
                        <textarea class="form-input form-textarea" name="links" placeholder="Main|https://example.com&#10;Backup|https://backup.example.com" required></textarea>
                    </div>
                    <div class="form-buttons">
                        <button type="button" class="grid-btn modal-close">Cancel</button>
                        <button type="submit" class="grid-btn primary">Add Proxy</button>
                    </div>
                </form>
            </div>
        </div>
        
        <div class="modal-overlay" id="add-game-modal">
            <div class="modal">
                <button class="modal-close">&times;</button>
                <div class="modal-header">
                    <div class="modal-title">Add New Game</div>
                </div>
                <form id="add-game-form">
                    <div class="form-group">
                        <label class="form-label">Game Name</label>
                        <input type="text" class="form-input" name="name" placeholder="Enter game name" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Icon</label>
                        <input type="text" class="form-input" name="icon" placeholder="Emoji or icon code" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Category</label>
                        <input type="text" class="form-input" name="category" placeholder="Action, Puzzle, etc." required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Game URL</label>
                        <input type="url" class="form-input" name="url" placeholder="https://example.com/game.html" required>
                    </div>
                    <div class="form-buttons">
                        <button type="button" class="grid-btn modal-close">Cancel</button>
                        <button type="submit" class="grid-btn primary">Add Game</button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Start Menu -->
        <div id="start-menu">
            <div class="start-header">
                <div class="start-logo">
                    <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <linearGradient id="logoGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:var(--acc);stop-opacity:1" />
                                <stop offset="50%" style="stop-color:var(--acc-light);stop-opacity:0.8" />
                                <stop offset="100%" style="stop-color:var(--acc-dark);stop-opacity:0.6" />
                            </linearGradient>
                        </defs>
                        <path d="M 50 10 L 70 50 L 90 90 L 10 90 L 30 50 Z" fill="url(#logoGrad)"/>
                        <path d="M 50 10 L 60 30 L 50 35 L 40 30 Z" fill="#ffffff"/>
                    </svg>
                </div>
                <div class="start-brand">
                    <div class="start-title">PEAK OS</div>
                    <div class="start-subtitle">Advanced Browser Environment</div>
                </div>
                <div class="start-version">v2.0</div>
            </div>
            <div class="start-content">
                <div class="start-section">
                    <div class="start-section-title">üöÄ Applications</div>
                    <div class="start-grid">
                        <div class="start-item" data-app="dashboard">
                            <div class="start-item-icon">üìä</div>
                            <div class="start-item-label">Dashboard</div>
                        </div>
                        <div class="start-item" data-app="hub">
                            <div class="start-item-icon">üåê</div>
                            <div class="start-item-label">Proxy Hub</div>
                        </div>
                        <div class="start-item" data-app="games">
                            <div class="start-item-icon">üéÆ</div>
                            <div class="start-item-label">Games</div>
                        </div>
                        <div class="start-item" data-app="styles">
                            <div class="start-item-icon">üé®</div>
                            <div class="start-item-label">Styles</div>
                        </div>
                        <div class="start-item" data-app="partners">
                            <div class="start-item-icon">ü§ù</div>
                            <div class="start-item-label">Partners</div>
                        </div>
                        <div class="start-item" data-app="updates">
                            <div class="start-item-icon">üîÑ</div>
                            <div class="start-item-label">Updates</div>
                        </div>
                    </div>
                </div>
                <div class="start-section">
                    <div class="start-section-title">‚ö° Quick Actions</div>
                    <div class="start-quick-links">
                        <div class="quick-link" data-action="add-proxy">
                            <div class="quick-link-icon">‚ûï</div>
                            <div class="quick-link-text">Add New Proxy</div>
                        </div>
                        <div class="quick-link" data-action="add-game">
                            <div class="quick-link-icon">üéÆ</div>
                            <div class="quick-link-text">Add New Game</div>
                        </div>
                        <div class="quick-link" data-action="settings">
                            <div class="quick-link-icon">‚öôÔ∏è</div>
                            <div class="quick-link-text">System Settings</div>
                        </div>
                        <div class="quick-link" data-action="lock">
                            <div class="quick-link-icon">üîí</div>
                            <div class="quick-link-text">Lock Screen</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Taskbar -->
        <div id="taskbar">
            <div class="taskbar-start">
                <button class="start-btn" id="start-btn">
                    <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                        <path d="M 50 10 L 70 50 L 90 90 L 10 90 L 30 50 Z" fill="currentColor"/>
                        <path d="M 50 10 L 60 30 L 50 35 L 40 30 Z" fill="#ffffff"/>
                    </svg>
                </button>
                <div class="search-taskbar">
                    <span>üîç</span>
                    <input type="text" id="taskbar-search" placeholder="Search apps, proxies, games...">
                    <div class="search-results" id="search-results"></div>
                </div>
            </div>
            
            <div class="taskbar-windows" id="taskbar-windows"></div>
            
            <div class="taskbar-end">
                <div class="taskbar-icon" id="settings-btn" title="Settings">‚öôÔ∏è</div>
                <div class="taskbar-icon" id="add-proxy-btn" title="Add Proxy">‚ûï</div>
                <div class="taskbar-icon" id="lock-btn" title="Lock Screen">üîí</div>
                <div class="taskbar-clock" id="taskbar-clock">
                    <div class="clock-time">--:--</div>
                    <div class="clock-date">---</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Context Menu -->
    <div id="context-menu"></div>

    <script>
// Enhanced version with all requested features

// Utility functions
const $ = s => document.querySelector(s);
const $$ = s => [...document.querySelectorAll(s)];

// Data management
const loadData = (key, def={}) => {
    try { return JSON.parse(localStorage.getItem('peakos-'+key) || JSON.stringify(def)); }
    catch { return def; }
};

const saveData = (key, data) => localStorage.setItem('peakos-'+key, JSON.stringify(data));

// Enhanced settings
let settings = loadData('settings', {
    theme: 'midnight',
    background: 'gradient-1',
    customBg: null,
    contrast: false,
    motion: false,
    font: false,
    performance: false,
    cursor: true,
    animations: true,
    notifications: true,
    blur: true
});

// Apply settings
function applySettings() {
    document.body.className = `theme-${settings.theme}`;
    document.body.classList.toggle('high-contrast', settings.contrast);
    document.body.classList.toggle('reduced-motion', settings.motion);
    document.body.classList.toggle('font-large', settings.font);
    document.body.classList.toggle('performance-mode', settings.performance);
    document.body.classList.toggle('no-cursor', !settings.cursor);
    if (!settings.animations) {
        document.body.style.setProperty('--shadow-lg', 'none');
        document.body.style.setProperty('--shadow-md', 'none');
    }
    if (!settings.blur) {
        document.querySelectorAll('*').forEach(el => {
            el.style.backdropFilter = 'none';
        });
    }
    applyBackground(settings.background, settings.customBg);
}
applySettings();

// Background system
function applyBackground(bg, customUrl) {
    const el = $('#desktop-bg');
    el.className = 'bg-' + bg;
    el.style.backgroundImage = bg === 'custom' && customUrl ? `url(${customUrl})` : '';
}

// Toast notifications
const toast = (title, msg, type='success') => {
    if (!settings.notifications) return;
    const t = document.createElement('div');
    t.className = `toast ${type}`;
    t.innerHTML = `
        <div class="toast-icon">${type==='success'?'‚úì':'‚úï'}</div>
        <div class="toast-content">
            <div class="toast-title">${title}</div>
            <div class="toast-msg">${msg}</div>
        </div>
    `;
    document.body.appendChild(t);
    setTimeout(() => t.classList.add('show'), 10);
    setTimeout(() => {
        t.classList.remove('show');
        setTimeout(() => t.remove(), 400);
    }, 3000);
};

// Cursor management - Simplified without ring
const cursor = $('#cursor');
let cursorX = 0, cursorY = 0;

document.addEventListener('mousemove', e => {
    cursorX = e.clientX;
    cursorY = e.clientY;
    
    if (document.body.classList.contains('unlocked') && settings.cursor) {
        cursor.style.left = cursorX + 'px';
        cursor.style.top = cursorY + 'px';
    }
});

document.addEventListener('mousedown', () => cursor.classList.add('click'));
document.addEventListener('mouseup', () => cursor.classList.remove('click'));

const bindHover = () => {
    const hoverElements = 'button,.desktop-icon,.start-item,.window-tab,.taskbar-icon,.window-btn,.context-item,.theme-card,.bg-card,.item-card,.search-result-item,.grid-btn,.action-btn,.link-btn,.quick-link';
    $$(hoverElements).forEach(el => {
        if (settings.cursor) {
            el.addEventListener('mouseenter', () => cursor.classList.add('hover'));
            el.addEventListener('mouseleave', () => cursor.classList.remove('hover'));
        }
    });
};

// UNLOCK SYSTEM
let unlockClicks = 0;
const unlockTrigger = $('#unlock-trigger');
const unlockStatus = $('#unlock-status');

if (unlockTrigger && unlockStatus) {
    unlockTrigger.addEventListener('click', function() {
        unlockClicks++;
        unlockStatus.textContent = `Click ${3-unlockClicks} more time${3-unlockClicks===1?'':'s'}`;
        
        // Add visual feedback
        this.style.transform = 'scale(0.95)';
        setTimeout(() => this.style.transform = '', 200);
        
        if (unlockClicks >= 3) {
            $('#disguise').classList.add('hide');
            
            setTimeout(() => {
                document.body.classList.add('unlocked');
                $('#disguise').style.display = 'none';
                
                // Initialize
                initBackground();
                bindHover();
                updateClock();
                
                toast('Welcome to PeakOS', 'System unlocked successfully');
            }, 500);
        }
    });
}

// Data with user additions
let PROXIES = loadData('proxies', [
    {id:'truffled', name:'Truffled', icon:'üîµ', links:[{t:'Main', u:'https://educational.radissontucson.com/'},{t:'Backup', u:'https://vacation.briaquaticcabinets.com/'}]},
    {id:'overcloacked', name:'Overcloacked', icon:'‚ö°', links:[{t:'Primary', u:'https://d58o0iyi.beanweb.qzz.io.cdn.cloudflare.net/'}]},
    {id:'fern', name:'Fern', icon:'üåø', links:[{t:'Main', u:'https://apple1.vandrekalenderen.dk/'}]},
    {id:'infamous', name:'Infamous', icon:'üî•', links:[{t:'Link 1', u:'https://team-anti-drugs.acgcotton.com/'}]},
    {id:'void', name:'Void', icon:'üåå', links:[{t:'EDU', u:'https://edu.ucecom-craiova.ro'}]}
]);

let GAMES = loadData('games', [
    {id:'car-survival', icon:'üöó', name:'Car Survival 3D', cat:'Action', url:'https://rawcdn.githack.com/genizy/brainrot/main/car-survival-3d/index.html'},
    {id:'build-plane', icon:'‚úàÔ∏è', name:'Build a Plane', cat:'Adventure', url:'https://rawcdn.githack.com/genizy/brainrot/main/build-a-plane/index.html'},
    {id:'climbing', icon:'üßó', name:'Difficult Climbing', cat:'Adventure', url:'https://cdn.jsdelivr.net/gh/web-ports/adgac@main/index.html'},
    {id:'soundboard', icon:'üîä', name:'Soundboard', cat:'Audio', url:'https://cdn.jsdelivr.net/gh/genizy/soundboard@main/index.html'},
    {id:'polytrack', icon:'üèéÔ∏è', name:'PolyTrack', cat:'Racing', url:'https://cdn.jsdelivr.net/gh/genizy/polytrack@latest/index.html'}
]);

// PARTNERS DATA
const PARTNERS = [
    {name: 'Interstellar Proxy Network', icon: 'üöÄ', desc: 'Premium proxy services'},
    {name: 'GameHub Collective', icon: 'üéÆ', desc: 'Game distribution platform'},
    {name: 'Nebula Hosting', icon: '‚òÅÔ∏è', desc: 'Cloud hosting solutions'},
    {name: 'Quantum Security', icon: 'üîí', desc: 'Security and privacy tools'},
    {name: 'Synthwave Devs', icon: 'üë®‚Äçüíª', desc: 'Web application development'},
    {name: 'Retro Gaming Co.', icon: 'üëæ', desc: 'Classic game preservation'}
];

// UPDATES DATA
const UPDATES = [
    {version: '2.0', date: '2024', title: 'Major UI Overhaul', desc: 'Complete redesign with new themes and features'},
    {version: '1.5', date: '2024', title: 'Browser Engine Update', desc: 'Improved iframe handling and navigation'},
    {version: '1.2', date: '2023', title: 'Game Library Expansion', desc: 'Added 10+ new games'},
    {version: '1.0', date: '2023', title: 'Initial Release', desc: 'PeakOS Browser Environment launched'}
];

// Clock
function updateClock() {
    const now = new Date();
    const time = now.toLocaleTimeString('en-US', {hour: '2-digit', minute: '2-digit'});
    const date = now.toLocaleDateString('en-US', {weekday: 'short', month: 'short', day: 'numeric'});
    
    const clockEl = $('#taskbar-clock');
    if (clockEl) {
        clockEl.querySelector('.clock-time').textContent = time;
        clockEl.querySelector('.clock-date').textContent = date;
    }
}
setInterval(updateClock, 1000);

// Start Menu
let startMenuOpen = false;
const startBtn = $('#start-btn');
const startMenu = $('#start-menu');

if (startBtn && startMenu) {
    startBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        startMenuOpen = !startMenuOpen;
        startMenu.classList.toggle('show', startMenuOpen);
    });
}

function closeStartMenu() {
    startMenuOpen = false;
    if (startMenu) startMenu.classList.remove('show');
}

document.addEventListener('click', (e) => {
    if (startMenuOpen && !e.target.closest('#start-menu') && !e.target.closest('#start-btn')) {
        closeStartMenu();
    }
});

// Modal handling
$$('.modal-close').forEach(btn => {
    btn.addEventListener('click', () => {
        $$('.modal-overlay').forEach(m => m.classList.remove('show'));
    });
});

$$('.modal-overlay').forEach(modal => {
    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            modal.classList.remove('show');
        }
    });
});

// Add Proxy functionality
$('#add-proxy-form')?.addEventListener('submit', (e) => {
    e.preventDefault();
    const formData = new FormData(e.target);
    const name = formData.get('name');
    const icon = formData.get('icon');
    const linksText = formData.get('links');
    
    const links = linksText.split('\n').map(line => {
        const [t, u] = line.split('|').map(s => s.trim());
        return {t, u};
    }).filter(link => link.t && link.u);
    
    if (name && icon && links.length > 0) {
        const newProxy = {
            id: name.toLowerCase().replace(/\s+/g, '-'),
            name,
            icon,
            links
        };
        
        PROXIES.push(newProxy);
        saveData('proxies', PROXIES);
        $('#add-proxy-modal').classList.remove('show');
        toast('Proxy Added', `${name} has been added successfully`);
        
        // Refresh if proxy hub is open
        const hubWindow = windows.find(w => w.type === 'hub');
        if (hubWindow) {
            closeWindow(hubWindow.id);
            setTimeout(() => openProxyHub(), 100);
        }
    }
});

// Add Game functionality
$('#add-game-form')?.addEventListener('submit', (e) => {
    e.preventDefault();
    const formData = new FormData(e.target);
    const name = formData.get('name');
    const icon = formData.get('icon');
    const category = formData.get('category');
    const url = formData.get('url');
    
    if (name && icon && category && url) {
        const newGame = {
            id: name.toLowerCase().replace(/\s+/g, '-'),
            name,
            icon,
            cat: category,
            url
        };
        
        GAMES.push(newGame);
        saveData('games', GAMES);
        $('#add-game-modal').classList.remove('show');
        toast('Game Added', `${name} has been added to your library`);
        
        // Refresh if games app is open
        const gamesWindow = windows.find(w => w.type === 'games');
        if (gamesWindow) {
            closeWindow(gamesWindow.id);
            setTimeout(() => openGamesApp(), 100);
        }
    }
});

// Quick actions
$$('.quick-link[data-action]').forEach(link => {
    link.addEventListener('click', () => {
        const action = link.dataset.action;
        switch(action) {
            case 'add-proxy':
                $('#add-proxy-modal').classList.add('show');
                break;
            case 'add-game':
                $('#add-game-modal').classList.add('show');
                break;
            case 'settings':
                openStylesApp();
                break;
            case 'lock':
                lockBtn.click();
                break;
        }
        closeStartMenu();
    });
});

// Taskbar buttons
$('#add-proxy-btn')?.addEventListener('click', () => {
    $('#add-proxy-modal').classList.add('show');
});

$('#settings-btn')?.addEventListener('click', () => {
    openStylesApp();
});

// Search functionality
const searchInput = $('#taskbar-search');
const searchResults = $('#search-results');

if (searchInput && searchResults) {
    searchInput.addEventListener('input', (e) => {
        const query = e.target.value.toLowerCase().trim();
        searchResults.innerHTML = '';
        
        if (query.length < 2) {
            searchResults.classList.remove('show');
            return;
        }
        
        const results = [];
        
        // Search apps
        ['dashboard', 'hub', 'games', 'styles', 'partners', 'updates'].forEach(app => {
            if (app.includes(query)) {
                results.push({
                    type: 'app',
                    icon: getAppIcon(app),
                    title: app.charAt(0).toUpperCase() + app.slice(1),
                    action: () => openApp(app)
                });
            }
        });
        
        // Search proxies
        PROXIES.forEach(proxy => {
            if (proxy.name.toLowerCase().includes(query)) {
                results.push({
                    type: 'proxy',
                    icon: proxy.icon,
                    title: proxy.name,
                    action: () => openProxy(proxy)
                });
            }
        });
        
        // Search games
        GAMES.forEach(game => {
            if (game.name.toLowerCase().includes(query) || game.cat.toLowerCase().includes(query)) {
                results.push({
                    type: 'game',
                    icon: game.icon,
                    title: game.name,
                    subtitle: game.cat,
                    action: () => openGame(game, true)
                });
            }
        });
        
        if (results.length > 0) {
            searchResults.innerHTML = results.map(r => `
                <div class="search-result-item">
                    <div class="search-result-icon">${r.icon}</div>
                    <div class="search-result-content">
                        <div class="search-result-title">${r.title}</div>
                        ${r.subtitle ? `<div class="search-result-type">${r.subtitle}</div>` : ''}
                    </div>
                </div>
            `).join('');
            
            searchResults.classList.add('show');
            
            $$('.search-result-item').forEach((item, idx) => {
                item.addEventListener('click', results[idx].action);
            });
        } else {
            searchResults.classList.remove('show');
        }
    });
    
    // Close search when clicking outside
    document.addEventListener('click', (e) => {
        if (!e.target.closest('.search-taskbar')) {
            searchResults.classList.remove('show');
        }
    });
}

function getAppIcon(app) {
    const icons = {
        dashboard: 'üìä',
        hub: 'üåê',
        games: 'üéÆ',
        styles: 'üé®',
        partners: 'ü§ù',
        updates: 'üîÑ'
    };
    return icons[app] || 'üìÅ';
}

// Window management with Interact.js
let windows = [];
let windowIdCounter = 0;
let activeWindowId = null;

const createWindow = (title, icon, type, onContentReady) => {
    const id = `win-${windowIdCounter++}`;
    
    const win = document.createElement('div');
    win.className = 'window';
    win.id = id;
    win.style.top = (60 + windows.length * 30) + 'px';
    win.style.left = (120 + windows.length * 30) + 'px';
    win.style.width = '800px';
    win.style.height = '600px';
    
    win.innerHTML = `
        <div class="window-titlebar">
            <div class="window-title">${icon} ${title}</div>
            <div class="window-controls">
                <button class="window-btn minimize" title="Minimize">‚àí</button>
                <button class="window-btn maximize" title="Maximize">‚ñ°</button>
                <button class="window-btn close" title="Close">‚úï</button>
            </div>
        </div>
        <div class="tab-content active" id="content-${id}"></div>
        <div class="window-resize-handle window-resize-n"></div>
        <div class="window-resize-handle window-resize-s"></div>
        <div class="window-resize-handle window-resize-e"></div>
        <div class="window-resize-handle window-resize-w"></div>
        <div class="window-resize-handle window-resize-ne"></div>
        <div class="window-resize-handle window-resize-nw"></div>
        <div class="window-resize-handle window-resize-se"></div>
        <div class="window-resize-handle window-resize-sw"></div>
    `;
    
    $('#windows-container').appendChild(win);
    
    // Make window draggable and resizable
    initInteractWindow(win);
    
    // Controls
    win.querySelector('.close').addEventListener('click', () => closeWindow(id));
    win.querySelector('.minimize').addEventListener('click', () => minimizeWindow(id));
    win.querySelector('.maximize').addEventListener('click', () => toggleMaximize(id));
    
    // Focus
    win.addEventListener('mousedown', () => focusWindow(id));
    
    // Add to array
    windows.push({id, title, icon, type, minimized: false});
    
    // Show window
    setTimeout(() => {
        win.classList.add('show');
        focusWindow(id);
        if (onContentReady) onContentReady($(`#content-${id}`));
    }, 50);
    
    updateTaskbarWindows();
    bindHover();
    
    return id;
};

function initInteractWindow(win) {
    let x = 0, y = 0;
    
    interact(win)
        .draggable({
            listeners: {
                start(event) {
                    focusWindow(win.id);
                },
                move(event) {
                    x += event.dx;
                    y += event.dy;
                    
                    if (!win.classList.contains('maximized')) {
                        win.style.left = `${x}px`;
                        win.style.top = `${y}px`;
                    }
                }
            }
        })
        .resizable({
            edges: { left: true, right: true, bottom: true, top: true },
            listeners: {
                move(event) {
                    if (!win.classList.contains('maximized')) {
                        Object.assign(win.style, {
                            width: `${event.rect.width}px`,
                            height: `${event.rect.height}px`,
                            left: `${event.rect.left}px`,
                            top: `${event.rect.top}px`
                        });
                    }
                }
            }
        });
}

const closeWindow = (id) => {
    const win = $(`#${id}`);
    if (win) {
        win.classList.remove('show');
        setTimeout(() => win.remove(), 200);
    }
    windows = windows.filter(w => w.id !== id);
    updateTaskbarWindows();
};

const minimizeWindow = (id) => {
    const win = $(`#${id}`);
    if (win) {
        win.classList.add('minimized');
        const winData = windows.find(w => w.id === id);
        if (winData) winData.minimized = true;
    }
    updateTaskbarWindows();
};

const restoreWindow = (id) => {
    const win = $(`#${id}`);
    if (win) {
        win.classList.remove('minimized');
        const winData = windows.find(w => w.id === id);
        if (winData) winData.minimized = false;
        focusWindow(id);
    }
    updateTaskbarWindows();
};

const toggleMaximize = (id) => {
    const win = $(`#${id}`);
    if (win) win.classList.toggle('maximized');
};

const focusWindow = (id) => {
    $$('.window').forEach(w => w.style.zIndex = 100);
    const win = $(`#${id}`);
    if (win) win.style.zIndex = 101;
    activeWindowId = id;
    updateTaskbarWindows();
};

const updateTaskbarWindows = () => {
    const container = $('#taskbar-windows');
    if (!container) return;
    
    container.innerHTML = windows.map(w => `
        <div class="taskbar-window-btn ${w.id === activeWindowId && !w.minimized ? 'active' : ''}" data-id="${w.id}">
            <div class="taskbar-window-icon">${w.icon}</div>
            <div class="taskbar-window-title">${w.title}</div>
        </div>
    `).join('');
    
    $$('.taskbar-window-btn').forEach(btn => {
        const id = btn.dataset.id;
        btn.addEventListener('click', () => {
            const winData = windows.find(w => w.id === id);
            if (winData && winData.minimized) {
                restoreWindow(id);
            } else {
                focusWindow(id);
            }
        });
    });
    
    bindHover();
};

// Open apps
const openApp = (appId) => {
    switch(appId) {
        case 'dashboard': openDashboardApp(); break;
        case 'hub': openProxyHub(); break;
        case 'games': openGamesApp(); break;
        case 'styles': openStylesApp(); break;
        case 'partners': openPartnersApp(); break;
        case 'updates': openUpdatesApp(); break;
    }
    closeStartMenu();
};

const openDashboardApp = () => {
    createWindow('Dashboard', 'üìä', 'dashboard', (content) => {
        content.innerHTML = `
            <div class="content-grid">
                <div class="grid-header">
                    <div>
                        <div class="grid-title">Dashboard</div>
                        <div class="grid-subtitle">Welcome to PeakOS Browser Environment v2.0</div>
                    </div>
                    <div class="grid-controls">
                        <button class="grid-btn" onclick="openApp('settings')">‚öôÔ∏è Settings</button>
                        <button class="grid-btn primary" onclick="openApp('hub')">üåê Browse Proxies</button>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 24px; margin: 40px 0;">
                    <div class="item-card" onclick="openApp('hub')">
                        <div class="item-header">
                            <div class="item-icon">üåê</div>
                            <div class="item-content">
                                <div class="item-name">Proxy Hub</div>
                                <div class="item-desc">${PROXIES.length} proxies available for secure browsing</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="item-card" onclick="openApp('games')">
                        <div class="item-header">
                            <div class="item-icon">üéÆ</div>
                            <div class="item-content">
                                <div class="item-name">Game Library</div>
                                <div class="item-desc">${GAMES.length} games across multiple categories</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="item-card" onclick="openApp('styles')">
                        <div class="item-header">
                            <div class="item-icon">üé®</div>
                            <div class="item-content">
                                <div class="item-name">Customization</div>
                                <div class="item-desc">8 themes, multiple backgrounds, and settings</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 40px; padding: 32px; background: var(--bg3); border-radius: 20px; border: 1px solid var(--border);">
                    <div style="font-size: 18px; font-weight: 700; margin-bottom: 20px; color: var(--acc);">‚ú® Quick Tips:</div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                        <div style="font-size: 14px; color: var(--txt2); line-height: 1.6;">
                            ‚Ä¢ <strong>Drag windows</strong> to move them around<br>
                            ‚Ä¢ <strong>Resize windows</strong> from any edge<br>
                            ‚Ä¢ Use <strong>search bar</strong> to find anything quickly<br>
                            ‚Ä¢ Add your own proxies and games
                        </div>
                        <div style="font-size: 14px; color: var(--txt2); line-height: 1.6;">
                            ‚Ä¢ <strong>Right-click</strong> for context menus<br>
                            ‚Ä¢ <strong>Ctrl+Shift+L</strong> to lock screen<br>
                            ‚Ä¢ Customize in <strong>Styles app</strong><br>
                            ‚Ä¢ Check <strong>Updates</strong> for new features
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        bindHover();
    });
};

const openProxyHub = () => {
    createWindow('Proxy Hub', 'üåê', 'hub', (content) => {
        content.innerHTML = `
            <div class="content-grid">
                <div class="grid-header">
                    <div>
                        <div class="grid-title">Proxy Hub</div>
                        <div class="grid-subtitle">${PROXIES.length} secure proxies available</div>
                    </div>
                    <div class="grid-controls">
                        <button class="grid-btn" onclick="openApp('dashboard')">‚Üê Back</button>
                        <button class="grid-btn primary" onclick="$('#add-proxy-modal').classList.add('show')">‚ûï Add Proxy</button>
                    </div>
                </div>
                
                <div class="item-grid">
                    ${PROXIES.map(p => `
                        <div class="item-card" data-proxy-id="${p.id}">
                            <div class="item-header">
                                <div class="item-icon">${p.icon}</div>
                                <div class="item-content">
                                    <div class="item-name">${p.name}</div>
                                    <div class="item-desc">${p.links.length} link${p.links.length>1?'s':''} available</div>
                                </div>
                            </div>
                            <div class="item-links">
                                ${p.links.map(link => `
                                    <button class="link-btn" data-url="${link.u}">${link.t}</button>
                                `).join('')}
                            </div>
                            <div class="item-actions">
                                <button class="action-btn delete" onclick="deleteProxy('${p.id}')">Delete</button>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
        
        $$('.link-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.stopPropagation();
                const proxy = PROXIES.find(p => p.id === btn.closest('.item-card').dataset.proxyId);
                if (proxy) {
                    const link = proxy.links.find(l => l.u === btn.dataset.url);
                    if (link) openProxyUrl(`${proxy.name} - ${link.t}`, proxy.icon, link.u);
                }
            });
        });
        
        $$('.item-card[data-proxy-id]').forEach(card => {
            card.addEventListener('click', (e) => {
                if (!e.target.closest('.link-btn') && !e.target.closest('.action-btn')) {
                    const proxy = PROXIES.find(p => p.id === card.dataset.proxyId);
                    if (proxy) openProxy(proxy);
                }
            });
        });
        
        bindHover();
    });
};

function deleteProxy(id) {
    if (confirm('Are you sure you want to delete this proxy?')) {
        PROXIES = PROXIES.filter(p => p.id !== id);
        saveData('proxies', PROXIES);
        toast('Proxy Deleted', 'Proxy has been removed');
        
        // Refresh window
        const hubWindow = windows.find(w => w.type === 'hub');
        if (hubWindow) {
            closeWindow(hubWindow.id);
            setTimeout(() => openProxyHub(), 100);
        }
    }
}

const openGamesApp = () => {
    createWindow('Games', 'üéÆ', 'games', (content) => {
        content.innerHTML = `
            <div class="content-grid">
                <div class="grid-header">
                    <div>
                        <div class="grid-title">Game Library</div>
                        <div class="grid-subtitle">${GAMES.length} games available across multiple categories</div>
                    </div>
                    <div class="grid-controls">
                        <button class="grid-btn" onclick="openApp('dashboard')">‚Üê Back</button>
                        <button class="grid-btn primary" onclick="$('#add-game-modal').classList.add('show')">‚ûï Add Game</button>
                    </div>
                </div>
                
                <div class="item-grid">
                    ${GAMES.map(g => `
                        <div class="item-card" data-game-id="${g.id}">
                            <div class="item-header">
                                <div class="item-icon">${g.icon}</div>
                                <div class="item-content">
                                    <div class="item-name">${g.name}</div>
                                    <div class="item-desc">${g.cat}</div>
                                </div>
                            </div>
                            <div class="item-actions">
                                <button class="action-btn" onclick="openGame(${JSON.stringify(g).replace(/"/g, '&quot;')}, true)">Play</button>
                                <button class="action-btn delete" onclick="deleteGame('${g.id}')">Delete</button>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
        
        bindHover();
    });
};

function deleteGame(id) {
    if (confirm('Are you sure you want to delete this game?')) {
        GAMES = GAMES.filter(g => g.id !== id);
        saveData('games', GAMES);
        toast('Game Deleted', 'Game has been removed from library');
        
        // Refresh window
        const gamesWindow = windows.find(w => w.type === 'games');
        if (gamesWindow) {
            closeWindow(gamesWindow.id);
            setTimeout(() => openGamesApp(), 100);
        }
    }
}

const openStylesApp = () => {
    createWindow('Styles', 'üé®', 'styles', (content) => {
        content.innerHTML = `
            <div class="styles-content">
                <div class="styles-section">
                    <div class="styles-section-title">üé® Themes</div>
                    <div class="theme-grid">
                        ${['midnight', 'neon', 'aurora', 'sunset', 'cyber', 'matrix', 'space', 'fire'].map(t => `
                            <div class="theme-card ${settings.theme===t?'active':''}" data-theme="${t}"
                                 style="--preview-bg: ${getThemeGradient(t)};">
                                <div class="theme-card-preview">${getThemeIcon(t)}</div>
                                <div class="theme-card-name">${t.charAt(0).toUpperCase()+t.slice(1)}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div class="styles-section">
                    <div class="styles-section-title">üñºÔ∏è Backgrounds</div>
                    <div class="bg-grid">
                        ${['gradient-1', 'gradient-2', 'gradient-3', 'gradient-4', 'stars', 'grid', 'waves'].map(b => `
                            <div class="bg-card ${settings.background===b?'active':''}" data-bg="${b}"
                                 style="--preview-bg: ${getBgPreview(b)};">
                                <div class="bg-card-preview"></div>
                                <div class="bg-card-name">${getBgName(b)}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div class="custom-bg-section">
                    <div class="styles-section-title">üì§ Custom Background</div>
                    <div class="custom-bg-preview" id="custom-bg-preview">
                        ${settings.customBg ? `<img src="${settings.customBg}" alt="Custom Background">` : 'No custom background set'}
                    </div>
                    <div class="custom-bg-controls">
                        <label class="grid-btn">
                            üìÅ Choose Image
                            <input type="file" id="bg-upload" accept="image/*" style="display: none;">
                        </label>
                        <button class="grid-btn ${!settings.customBg?'disabled':''}" 
                                onclick="resetCustomBg()" ${!settings.customBg?'disabled':''}>
                            üîÑ Reset
                        </button>
                    </div>
                </div>
                
                <div class="styles-section">
                    <div class="styles-section-title">‚öôÔ∏è Settings</div>
                    <div class="settings-controls">
                        ${[
                            {id:'cursor', label:'Custom Cursor', desc:'Enable/disable custom cursor'},
                            {id:'animations', label:'Animations', desc:'Enable/disable UI animations'},
                            {id:'notifications', label:'Notifications', desc:'Show toast notifications'},
                            {id:'blur', label:'Glass Effect', desc:'Enable blur effects'},
                            {id:'contrast', label:'High Contrast', desc:'Increase contrast for accessibility'},
                            {id:'font', label:'Large Font', desc:'Increase text size'}
                        ].map(setting => `
                            <div class="setting-item">
                                <div class="setting-info">
                                    <h4>${setting.label}</h4>
                                    <p>${setting.desc}</p>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" id="setting-${setting.id}" ${settings[setting.id]?'checked':''}>
                                    <span class="slider"></span>
                                </label>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
        `;
        
        // Theme selection
        $$('.theme-card').forEach(card => {
            card.addEventListener('click', () => {
                const theme = card.dataset.theme;
                $$('.theme-card').forEach(c => c.classList.remove('active'));
                card.classList.add('active');
                document.body.className = document.body.className.replace(/theme-\w+/g, '');
                document.body.classList.add(`theme-${theme}`);
                settings.theme = theme;
                saveData('settings', settings);
                toast('Theme Changed', `Switched to ${theme} theme`);
            });
        });
        
        // Background selection
        $$('.bg-card').forEach(card => {
            card.addEventListener('click', () => {
                const bg = card.dataset.bg;
                $$('.bg-card').forEach(c => c.classList.remove('active'));
                card.classList.add('active');
                settings.background = bg;
                settings.customBg = null;
                saveData('settings', settings);
                applyBackground(bg);
                $('#custom-bg-preview').innerHTML = 'No custom background set';
                toast('Background Changed', getBgName(bg));
            });
        });
        
        // Custom background upload
        $('#bg-upload').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = (ev) => {
                    settings.background = 'custom';
                    settings.customBg = ev.target.result;
                    saveData('settings', settings);
                    applyBackground('custom', ev.target.result);
                    $('#custom-bg-preview').innerHTML = `<img src="${ev.target.result}" alt="Custom Background">`;
                    $$('.bg-card').forEach(c => c.classList.remove('active'));
                    toast('Custom Background', 'Your image has been set as background');
                };
                reader.readAsDataURL(file);
            }
        });
        
        // Settings toggles
        $$('.switch input').forEach(input => {
            input.addEventListener('change', (e) => {
                const setting = e.target.id.replace('setting-', '');
                settings[setting] = e.target.checked;
                saveData('settings', settings);
                applySettings();
                toast('Setting Updated', `${setting.replace(/([A-Z])/g, ' $1').toLowerCase()} ${e.target.checked?'enabled':'disabled'}`);
            });
        });
        
        bindHover();
    });
};

function resetCustomBg() {
    settings.customBg = null;
    settings.background = 'gradient-1';
    saveData('settings', settings);
    applyBackground('gradient-1');
    $('#custom-bg-preview').innerHTML = 'No custom background set';
    $$('.bg-card').forEach(c => c.classList.remove('active'));
    $$('.bg-card[data-bg="gradient-1"]').forEach(c => c.classList.add('active'));
    toast('Background Reset', 'Custom background has been removed');
}

function getThemeGradient(theme) {
    const grads = {
        midnight: 'linear-gradient(135deg,#0a0e27,#1e2749)',
        neon: 'linear-gradient(135deg,#000814,#001233,#ff00ff)',
        aurora: 'linear-gradient(135deg,#0a1a2d,#1f3a6d,#00ffaa)',
        sunset: 'linear-gradient(135deg,#1a0e1a,#3d2340,#ff6b35)',
        cyber: 'linear-gradient(135deg,#0d0d1a,#27274d,#00ffff)',
        matrix: 'linear-gradient(135deg,#000f00,#002500,#00ff00)',
        space: 'linear-gradient(135deg,#000016,#020246,#9370ff)',
        fire: 'linear-gradient(135deg,#1a0500,#4d0f00,#ff3300)'
    };
    return grads[theme] || grads.midnight;
}

function getThemeIcon(theme) {
    const icons = {
        midnight:'üåô', neon:'üí°', aurora:'üåà', sunset:'üåÖ', cyber:'ü§ñ', matrix:'üíö', space:'üöÄ', fire:'üî•'
    };
    return icons[theme] || 'üé®';
}

function getBgPreview(bg) {
    const previews = {
        'gradient-1': 'linear-gradient(135deg, var(--bg), var(--bg3))',
        'gradient-2': 'linear-gradient(135deg, #0a0e27, #1e2749, #00d4ff22)',
        'gradient-3': 'linear-gradient(135deg, #1a0e0a, #3d2318)',
        'gradient-4': 'linear-gradient(135deg, #0a1a0e, #1e3d27)',
        'stars': '#000',
        'grid': 'repeating-linear-gradient(90deg, transparent, transparent 39px, var(--border) 40px), repeating-linear-gradient(0deg, transparent, transparent 39px, var(--border) 40px)',
        'waves': 'radial-gradient(circle at 20% 80%, rgba(0,212,255,0.2) 0%, transparent 50%), radial-gradient(circle at 80% 20%, rgba(168,85,247,0.2) 0%, transparent 50%), var(--bg)'
    };
    return previews[bg] || '';
}

function getBgName(bg) {
    const names = {
        'gradient-1': 'Primary Gradient',
        'gradient-2': 'Accent Gradient',
        'gradient-3': 'Sunset Gradient',
        'gradient-4': 'Forest Gradient',
        'stars': 'Starfield',
        'grid': 'Grid Pattern',
        'waves': 'Wave Mesh'
    };
    return names[bg] || bg;
}

const openPartnersApp = () => {
    createWindow('Partners', 'ü§ù', 'partners', (content) => {
        content.innerHTML = `
            <div class="content-grid">
                <div class="grid-header">
                    <div>
                        <div class="grid-title">Partners</div>
                        <div class="grid-subtitle">Our trusted partners and collaborators</div>
                    </div>
                </div>
                
                <div class="item-grid">
                    ${PARTNERS.map(p => `
                        <div class="item-card">
                            <div class="item-header">
                                <div class="item-icon">${p.icon}</div>
                                <div class="item-content">
                                    <div class="item-name">${p.name}</div>
                                    <div class="item-desc">${p.desc}</div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
        
        bindHover();
    });
};

const openUpdatesApp = () => {
    createWindow('Updates', 'üîÑ', 'updates', (content) => {
        content.innerHTML = `
            <div class="content-grid">
                <div class="grid-header">
                    <div>
                        <div class="grid-title">Updates</div>
                        <div class="grid-subtitle">Version history and upcoming features</div>
                    </div>
                </div>
                
                <div style="display: flex; flex-direction: column; gap: 20px; margin-top: 20px;">
                    ${UPDATES.map(u => `
                        <div class="item-card">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                <div style="font-size: 18px; font-weight: 700; color: var(--acc);">v${u.version}</div>
                                <div style="font-size: 14px; color: var(--txt2);">${u.date}</div>
                            </div>
                            <div style="font-size: 16px; font-weight: 600; color: var(--txt); margin-bottom: 8px;">${u.title}</div>
                            <div style="font-size: 14px; color: var(--txt2); line-height: 1.5;">${u.desc}</div>
                        </div>
                    `).join('')}
                    
                    <div class="item-card" style="border: 2px dashed var(--border-acc);">
                        <div style="font-size: 18px; font-weight: 700; color: var(--acc); margin-bottom: 12px;">üöÄ Upcoming</div>
                        <div style="font-size: 14px; color: var(--txt2); line-height: 1.6;">
                            ‚Ä¢ Offline mode support<br>
                            ‚Ä¢ More theme customization<br>
                            ‚Ä¢ Built-in media player<br>
                            ‚Ä¢ Plugin system<br>
                            ‚Ä¢ Mobile app version
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        bindHover();
    });
};

const openProxy = (proxy) => {
    if (proxy.links.length === 1) {
        openProxyUrl(proxy.name, proxy.icon, proxy.links[0].u);
    } else {
        showContextMenu(cursorX, cursorY, 
            proxy.links.map(link => ({
                icon: 'üîó',
                label: link.t,
                action: () => openProxyUrl(`${proxy.name} - ${link.t}`, proxy.icon, link.u)
            }))
        );
    }
};

const openProxyUrl = (title, icon, url) => {
    createWindow(title, icon, 'browser', (content) => {
        content.innerHTML = `
            <div class="frame-navbar">
                <button class="nav-btn" onclick="this.closest('.window').querySelector('iframe').src = '${url}'">‚Üª</button>
                <button class="nav-btn" onclick="window.open('${url}', '_blank')">‚Üó</button>
                <input class="nav-url" value="${url}" readonly>
                <button class="nav-go" onclick="navigateToUrl(this)">Go</button>
            </div>
            <div class="content-frame">
                <div class="frame-loading">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">Loading ${title}...</div>
                </div>
                <div class="frame-error">
                    <div class="error-icon">‚ö†Ô∏è</div>
                    <div class="error-title">Failed to Load</div>
                    <div class="error-msg">This content couldn't be loaded. Try opening in a new tab or check the URL.</div>
                    <button class="error-btn" onclick="window.open('${url}', '_blank')">Open in New Tab</button>
                </div>
                <iframe sandbox="allow-scripts allow-same-origin allow-popups allow-forms" 
                        allow="autoplay; fullscreen; microphone; camera"
                        referrerpolicy="no-referrer"
                        src="${url}"></iframe>
            </div>
        `;
        
        const iframe = content.querySelector('iframe');
        const loading = content.querySelector('.frame-loading');
        const error = content.querySelector('.frame-error');
        const urlInput = content.querySelector('.nav-url');
        
        // Make URL input editable and functional
        urlInput.removeAttribute('readonly');
        urlInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                navigateToUrl(urlInput);
            }
        });
        
        function navigateToUrl(input) {
            let newUrl = input.value.trim();
            if (!newUrl.startsWith('http')) {
                newUrl = 'https://' + newUrl;
                input.value = newUrl;
            }
            iframe.src = newUrl;
            loading.classList.remove('hide');
            error.classList.remove('show');
        }
        
        let loadTimeout = setTimeout(() => {
            loading.classList.add('hide');
            error.classList.add('show');
        }, 15000);
        
        iframe.addEventListener('load', () => {
            clearTimeout(loadTimeout);
            loading.classList.add('hide');
            urlInput.value = iframe.contentWindow.location.href || url;
        });
        
        iframe.addEventListener('error', () => {
            clearTimeout(loadTimeout);
            loading.classList.add('hide');
            error.classList.add('show');
        });
    });
};

const openGame = (game, newWindow = false) => {
    openProxyUrl(game.name, game.icon, game.url);
};

// Context menu
const showContextMenu = (x, y, items) => {
    const menu = $('#context-menu');
    if (!menu) return;
    
    menu.innerHTML = items.map(item => `
        <div class="context-item" data-action="${items.indexOf(item)}">
            <div class="context-icon">${item.icon}</div>
            <div>${item.label}</div>
        </div>
    `).join('');
    
    // Position menu
    const rect = menu.getBoundingClientRect();
    if (x + rect.width > window.innerWidth) x = window.innerWidth - rect.width;
    if (y + rect.height > window.innerHeight) y = window.innerHeight - rect.height;
    
    menu.style.left = x + 'px';
    menu.style.top = y + 'px';
    menu.classList.add('show');
    
    $$('.context-item').forEach((el, idx) => {
        el.addEventListener('click', () => {
            items[idx].action();
            menu.classList.remove('show');
        });
    });
    
    setTimeout(() => {
        const hide = () => {
            menu.classList.remove('show');
            document.removeEventListener('click', hide);
        };
        document.addEventListener('click', hide);
    }, 100);
    
    bindHover();
};

// Desktop icons
$$('.desktop-icon[data-app]').forEach(icon => {
    icon.addEventListener('dblclick', () => {
        if (document.body.classList.contains('unlocked')) {
            openApp(icon.dataset.app);
        }
    });
});

// Start items
$$('.start-item[data-app]').forEach(item => {
    item.addEventListener('click', () => {
        if (document.body.classList.contains('unlocked')) {
            openApp(item.dataset.app);
            closeStartMenu();
        }
    });
});

// Lock button
const lockBtn = $('#lock-btn');
if (lockBtn) {
    lockBtn.addEventListener('click', () => {
        document.body.classList.remove('unlocked');
        $('#disguise').style.display = 'block';
        setTimeout(() => $('#disguise').classList.remove('hide'), 10);
        unlockClicks = 0;
        if (unlockStatus) unlockStatus.textContent = 'Click 3 times to unlock';
        windows.forEach(w => closeWindow(w.id));
        closeStartMenu();
        toast('Locked', 'Screen locked successfully');
    });
}

// Keyboard shortcuts
document.addEventListener('keydown', e => {
    if (e.ctrlKey && e.shiftKey && e.key === 'L') {
        e.preventDefault();
        if (document.body.classList.contains('unlocked')) {
            lockBtn.click();
        }
    }
    if (e.key === 'Escape' && startMenuOpen) {
        closeStartMenu();
    }
});

// Background animation
function initBackground() {
    if (settings.performance) return;
    
    const canvas = $('#bg-canvas');
    if (!canvas) return;
    
    const ctx = canvas.getContext('2d');
    let w, h;
    
    const resize = () => {
        w = canvas.width = window.innerWidth;
        h = canvas.height = window.innerHeight;
    };
    resize();
    window.addEventListener('resize', resize);
    
    const particles = Array.from({length: 60}, () => ({
        x: Math.random() * w,
        y: Math.random() * h,
        vx: (Math.random() - 0.5) * 0.5,
        vy: (Math.random() - 0.5) * 0.5,
        r: Math.random() * 3 + 1,
        color: `rgba(0,212,255,${0.2 + Math.random() * 0.3})`
    }));
    
    const animate = () => {
        if (settings.performance) return;
        
        ctx.fillStyle = 'rgba(10,14,39,0.05)';
        ctx.fillRect(0, 0, w, h);
        
        particles.forEach(p => {
            p.x += p.vx;
            p.y += p.vy;
            
            if (p.x < 0 || p.x > w) p.vx *= -1;
            if (p.y < 0 || p.y > h) p.vy *= -1;
            
            ctx.beginPath();
            ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
            ctx.fillStyle = p.color;
            ctx.fill();
            
            // Connect nearby particles
            particles.forEach(p2 => {
                const dx = p.x - p2.x;
                const dy = p.y - p2.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance < 100) {
                    ctx.beginPath();
                    ctx.moveTo(p.x, p.y);
                    ctx.lineTo(p2.x, p2.y);
                    ctx.strokeStyle = `rgba(0,212,255,${0.1 * (1 - distance/100)})`;
                    ctx.lineWidth = 1;
                    ctx.stroke();
                }
            });
        });
        
        requestAnimationFrame(animate);
    };
    animate();
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', () => {
    updateClock();
    bindHover();
    
    // Auto-reset click counter after 10 seconds
    setInterval(() => {
        if (unlockClicks > 0 && unlockClicks < 3) {
            unlockClicks = 0;
            if (unlockStatus) {
                unlockStatus.textContent = 'Click 3 times to unlock';
            }
        }
    }, 10000);
});
    </script>
</body>
</html>
